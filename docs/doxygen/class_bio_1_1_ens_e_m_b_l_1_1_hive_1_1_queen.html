<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>ensembl-hive: Bio::EnsEMBL::Hive::Queen Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">ensembl-hive
   &#160;<span id="projectnumber">1.9</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="inherits.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_queen.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_queen-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">Bio::EnsEMBL::Hive::Queen Class Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png" alt="+"/> Inheritance diagram for Bio::EnsEMBL::Hive::Queen:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><img src="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_queen__inherit__graph.png" border="0" usemap="#_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_queen_inherit__map" alt="Inheritance graph"/></div>
<map name="_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_queen_inherit__map" id="_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_queen_inherit__map">
<area shape="rect" id="node2" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_object_adaptor.html" title="Bio::EnsEMBL::Hive\l::DBSQL::ObjectAdaptor" alt="" coords="5,187,171,229"/><area shape="rect" id="node3" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor.html" title="Bio::EnsEMBL::Hive\l::DBSQL::BaseAdaptor" alt="" coords="9,97,167,138"/></map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<div id="dynsection-1" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-1-trigger" src="closed.png" alt="+"/> Collaboration diagram for Bio::EnsEMBL::Hive::Queen:</div>
<div id="dynsection-1-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-1-content" class="dyncontent" style="display:none;">
<div class="center"><img src="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_queen__coll__graph.png" border="0" usemap="#_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_queen_coll__map" alt="Collaboration graph"/></div>
<map name="_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_queen_coll__map" id="_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_queen_coll__map">
<area shape="rect" id="node2" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_object_adaptor.html" title="Bio::EnsEMBL::Hive\l::DBSQL::ObjectAdaptor" alt="" coords="5,187,171,229"/><area shape="rect" id="node3" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor.html" title="Bio::EnsEMBL::Hive\l::DBSQL::BaseAdaptor" alt="" coords="9,97,167,138"/></map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a545edfa6d9aa715376d5ed7d20767755"><td class="memItemLeft" align="right" valign="top">public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_queen.html#a545edfa6d9aa715376d5ed7d20767755">default_table_name</a> ()</td></tr>
<tr class="separator:a545edfa6d9aa715376d5ed7d20767755"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab0c7e6cbb62054c0076d73a52efe9141"><td class="memItemLeft" align="right" valign="top">public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_queen.html#ab0c7e6cbb62054c0076d73a52efe9141">default_insertion_method</a> ()</td></tr>
<tr class="separator:ab0c7e6cbb62054c0076d73a52efe9141"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af9d2e010bf4d53356d2efde2367c5472"><td class="memItemLeft" align="right" valign="top">public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_queen.html#af9d2e010bf4d53356d2efde2367c5472">object_class</a> ()</td></tr>
<tr class="separator:af9d2e010bf4d53356d2efde2367c5472"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9cd9baa52f9e7a2240ffb979518cfee1"><td class="memItemLeft" align="right" valign="top">public <a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_worker.html">Bio::EnsEMBL::Hive::Worker</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_queen.html#a9cd9baa52f9e7a2240ffb979518cfee1">create_new_worker</a> ()</td></tr>
<tr class="separator:a9cd9baa52f9e7a2240ffb979518cfee1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adcc937a7a48d51f801d65757bc55bda2"><td class="memItemLeft" align="right" valign="top">public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_queen.html#adcc937a7a48d51f801d65757bc55bda2">specialize_new_worker</a> ()</td></tr>
<tr class="separator:adcc937a7a48d51f801d65757bc55bda2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1dc35ff50f5375e8796f12d17b372773"><td class="memItemLeft" align="right" valign="top">public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_queen.html#a1dc35ff50f5375e8796f12d17b372773">register_worker_death</a> ()</td></tr>
<tr class="separator:a1dc35ff50f5375e8796f12d17b372773"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a020be70f3da4eca961fef537e68daca6"><td class="memItemLeft" align="right" valign="top">public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_queen.html#a020be70f3da4eca961fef537e68daca6">check_for_dead_workers</a> ()</td></tr>
<tr class="separator:a020be70f3da4eca961fef537e68daca6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8ec0da9cd78a6fc994786f65b8710a7d"><td class="memItemLeft" align="right" valign="top">public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_queen.html#a8ec0da9cd78a6fc994786f65b8710a7d">check_in_worker</a> ()</td></tr>
<tr class="separator:a8ec0da9cd78a6fc994786f65b8710a7d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a46f196406a5bd9c452a5f94361a2eebd"><td class="memItemLeft" align="right" valign="top">public void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_queen.html#a46f196406a5bd9c452a5f94361a2eebd">reset_job_by_dbID_and_sync</a> ()</td></tr>
<tr class="separator:a46f196406a5bd9c452a5f94361a2eebd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a47b088cb6be9493e6853b5ee0b20b522"><td class="memItemLeft" align="right" valign="top">public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_queen.html#a47b088cb6be9493e6853b5ee0b20b522">fetch_overdue_workers</a> ()</td></tr>
<tr class="separator:a47b088cb6be9493e6853b5ee0b20b522"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1ec8aba875ab47959d2714b32b04a5d2"><td class="memItemLeft" align="right" valign="top">public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_queen.html#a1ec8aba875ab47959d2714b32b04a5d2">fetch_all_dead_workers_with_jobs</a> ()</td></tr>
<tr class="separator:a1ec8aba875ab47959d2714b32b04a5d2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2892c256744ac4bdd4f90b9bcc238735"><td class="memItemLeft" align="right" valign="top">public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_queen.html#a2892c256744ac4bdd4f90b9bcc238735">synchronize_hive</a> ()</td></tr>
<tr class="separator:a2892c256744ac4bdd4f90b9bcc238735"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abe0354cbdbf898d95cf08cb2d167ba38"><td class="memItemLeft" align="right" valign="top">public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_queen.html#abe0354cbdbf898d95cf08cb2d167ba38">safe_synchronize_AnalysisStats</a> ()</td></tr>
<tr class="separator:abe0354cbdbf898d95cf08cb2d167ba38"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2f39e9a7a7eacf12c8c6262f32b7ffce"><td class="memItemLeft" align="right" valign="top">public Newly&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_queen.html#a2f39e9a7a7eacf12c8c6262f32b7ffce">synchronize_AnalysisStats</a> ()</td></tr>
<tr class="separator:a2f39e9a7a7eacf12c8c6262f32b7ffce"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afdadb6fce4eb7469f6de433612867dd5"><td class="memItemLeft" align="right" valign="top">public Int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_queen.html#afdadb6fce4eb7469f6de433612867dd5">get_num_failed_analyses</a> ()</td></tr>
<tr class="separator:afdadb6fce4eb7469f6de433612867dd5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abe36b590f923d7e82d3577f484bd6056"><td class="memItemLeft" align="right" valign="top">public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_queen.html#abe36b590f923d7e82d3577f484bd6056">get_hive_current_load</a> ()</td></tr>
<tr class="separator:abe36b590f923d7e82d3577f484bd6056"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afbb012326e074b38548ac7341404774b"><td class="memItemLeft" align="right" valign="top">public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_queen.html#afbb012326e074b38548ac7341404774b">count_running_workers</a> ()</td></tr>
<tr class="separator:afbb012326e074b38548ac7341404774b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad5392456810e1f4bb16291b54a731c0a"><td class="memItemLeft" align="right" valign="top">public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_queen.html#ad5392456810e1f4bb16291b54a731c0a">get_workers_rank</a> ()</td></tr>
<tr class="separator:ad5392456810e1f4bb16291b54a731c0a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a51b365aa339df1f733167970be158c63"><td class="memItemLeft" align="right" valign="top">public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_queen.html#a51b365aa339df1f733167970be158c63">get_remaining_jobs_show_hive_progress</a> ()</td></tr>
<tr class="separator:a51b365aa339df1f733167970be158c63"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad396c5be7d6806c71b5740054325d5e6"><td class="memItemLeft" align="right" valign="top">public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_queen.html#ad396c5be7d6806c71b5740054325d5e6">print_analysis_status</a> ()</td></tr>
<tr class="separator:ad396c5be7d6806c71b5740054325d5e6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af91dbe0832893ec7ec3ecc8a7f7164dd"><td class="memItemLeft" align="right" valign="top">public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_queen.html#af91dbe0832893ec7ec3ecc8a7f7164dd">print_running_worker_counts</a> ()</td></tr>
<tr class="separator:af91dbe0832893ec7ec3ecc8a7f7164dd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a422e896db7c973b0385bbafd2c8aa556"><td class="memItemLeft" align="right" valign="top">public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_queen.html#a422e896db7c973b0385bbafd2c8aa556">monitor</a> ()</td></tr>
<tr class="separator:a422e896db7c973b0385bbafd2c8aa556"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab4f2cf470e0b3bbe732dd50c22e4deca"><td class="memItemLeft" align="right" valign="top">public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_queen.html#ab4f2cf470e0b3bbe732dd50c22e4deca">register_all_workers_dead</a> ()</td></tr>
<tr class="separator:ab4f2cf470e0b3bbe732dd50c22e4deca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pub_methods_class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_object_adaptor"><td colspan="2" onclick="javascript:toggleInherit('pub_methods_class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_object_adaptor')"><img src="closed.png" alt="-"/>&#160;Public Member Functions inherited from <a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_object_adaptor.html">Bio::EnsEMBL::Hive::DBSQL::ObjectAdaptor</a></td></tr>
<tr class="memitem:a834186b707376a4ead29771860ab440f inherit pub_methods_class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_object_adaptor"><td class="memItemLeft" align="right" valign="top">public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_object_adaptor.html#a834186b707376a4ead29771860ab440f">object_class</a> ()</td></tr>
<tr class="separator:a834186b707376a4ead29771860ab440f inherit pub_methods_class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_object_adaptor"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af1b4e5cdd9865d10338aafe4c6d047c0 inherit pub_methods_class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_object_adaptor"><td class="memItemLeft" align="right" valign="top">public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_object_adaptor.html#af1b4e5cdd9865d10338aafe4c6d047c0">slicer</a> ()</td></tr>
<tr class="separator:af1b4e5cdd9865d10338aafe4c6d047c0 inherit pub_methods_class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_object_adaptor"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a02d847dd4df770edb4bdbc5ed309a2d5 inherit pub_methods_class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_object_adaptor"><td class="memItemLeft" align="right" valign="top">public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_object_adaptor.html#a02d847dd4df770edb4bdbc5ed309a2d5">objectify</a> ()</td></tr>
<tr class="separator:a02d847dd4df770edb4bdbc5ed309a2d5 inherit pub_methods_class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_object_adaptor"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aee5049447ae13e0e4f41a1843899c4a0 inherit pub_methods_class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_object_adaptor"><td class="memItemLeft" align="right" valign="top">public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_object_adaptor.html#aee5049447ae13e0e4f41a1843899c4a0">mark_stored</a> ()</td></tr>
<tr class="separator:aee5049447ae13e0e4f41a1843899c4a0 inherit pub_methods_class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_object_adaptor"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a90b0359523ef5040fd0e839edd83cca4 inherit pub_methods_class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_object_adaptor"><td class="memItemLeft" align="right" valign="top">public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_object_adaptor.html#a90b0359523ef5040fd0e839edd83cca4">create_new</a> ()</td></tr>
<tr class="separator:a90b0359523ef5040fd0e839edd83cca4 inherit pub_methods_class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_object_adaptor"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pub_methods_class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor"><td colspan="2" onclick="javascript:toggleInherit('pub_methods_class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor')"><img src="closed.png" alt="-"/>&#160;Public Member Functions inherited from <a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor.html">Bio::EnsEMBL::Hive::DBSQL::BaseAdaptor</a></td></tr>
<tr class="memitem:ae3e95ef6cee275aa2ace188e45da854a inherit pub_methods_class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor"><td class="memItemLeft" align="right" valign="top">public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor.html#ae3e95ef6cee275aa2ace188e45da854a">default_table_name</a> ()</td></tr>
<tr class="separator:ae3e95ef6cee275aa2ace188e45da854a inherit pub_methods_class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a129b813103eead72607723d43d3a6567 inherit pub_methods_class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor"><td class="memItemLeft" align="right" valign="top">public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor.html#a129b813103eead72607723d43d3a6567">default_insertion_method</a> ()</td></tr>
<tr class="separator:a129b813103eead72607723d43d3a6567 inherit pub_methods_class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac73267d0e33aad126c188108f7e7c468 inherit pub_methods_class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor"><td class="memItemLeft" align="right" valign="top">public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor.html#ac73267d0e33aad126c188108f7e7c468">default_overflow_limit</a> ()</td></tr>
<tr class="separator:ac73267d0e33aad126c188108f7e7c468 inherit pub_methods_class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2f77cbefb20d4b4e3a40cf75ce420036 inherit pub_methods_class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor"><td class="memItemLeft" align="right" valign="top">public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor.html#a2f77cbefb20d4b4e3a40cf75ce420036">default_input_column_mapping</a> ()</td></tr>
<tr class="separator:a2f77cbefb20d4b4e3a40cf75ce420036 inherit pub_methods_class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1f8bbd7bad6d23b679d4c07ab4121085 inherit pub_methods_class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor"><td class="memItemLeft" align="right" valign="top">public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor.html#a1f8bbd7bad6d23b679d4c07ab4121085">overflow_limit</a> ()</td></tr>
<tr class="separator:a1f8bbd7bad6d23b679d4c07ab4121085 inherit pub_methods_class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac7e056384281180e1b314889fc7c317f inherit pub_methods_class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor"><td class="memItemLeft" align="right" valign="top">public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor.html#ac7e056384281180e1b314889fc7c317f">input_column_mapping</a> ()</td></tr>
<tr class="separator:ac7e056384281180e1b314889fc7c317f inherit pub_methods_class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9ee7f9cfe42ad4993d0b544acfb4e1f5 inherit pub_methods_class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor"><td class="memItemLeft" align="right" valign="top">public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor.html#a9ee7f9cfe42ad4993d0b544acfb4e1f5">table_name</a> ()</td></tr>
<tr class="separator:a9ee7f9cfe42ad4993d0b544acfb4e1f5 inherit pub_methods_class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acd1bde351fcbdfddf8fa9896c8716514 inherit pub_methods_class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor"><td class="memItemLeft" align="right" valign="top">public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor.html#acd1bde351fcbdfddf8fa9896c8716514">insertion_method</a> ()</td></tr>
<tr class="separator:acd1bde351fcbdfddf8fa9896c8716514 inherit pub_methods_class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ada55ab8c29c95535953efb0ca8c1d805 inherit pub_methods_class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor"><td class="memItemLeft" align="right" valign="top">public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor.html#ada55ab8c29c95535953efb0ca8c1d805">column_set</a> ()</td></tr>
<tr class="separator:ada55ab8c29c95535953efb0ca8c1d805 inherit pub_methods_class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae98ea2fa8c6a85c6df918b9816bd6cbf inherit pub_methods_class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor"><td class="memItemLeft" align="right" valign="top">public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor.html#ae98ea2fa8c6a85c6df918b9816bd6cbf">primary_key</a> ()</td></tr>
<tr class="separator:ae98ea2fa8c6a85c6df918b9816bd6cbf inherit pub_methods_class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae47ff32866fc8b69d8463680b5ead1d2 inherit pub_methods_class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor"><td class="memItemLeft" align="right" valign="top">public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor.html#ae47ff32866fc8b69d8463680b5ead1d2">updatable_column_list</a> ()</td></tr>
<tr class="separator:ae47ff32866fc8b69d8463680b5ead1d2 inherit pub_methods_class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7da3298fc1c03c9e7e07123fb710e9a5 inherit pub_methods_class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor"><td class="memItemLeft" align="right" valign="top">public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor.html#a7da3298fc1c03c9e7e07123fb710e9a5">autoinc_id</a> ()</td></tr>
<tr class="separator:a7da3298fc1c03c9e7e07123fb710e9a5 inherit pub_methods_class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a348c46fdc789f2eb970dfcc5260aaa28 inherit pub_methods_class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor"><td class="memItemLeft" align="right" valign="top">protected&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor.html#a348c46fdc789f2eb970dfcc5260aaa28">_table_info_loader</a> ()</td></tr>
<tr class="separator:a348c46fdc789f2eb970dfcc5260aaa28 inherit pub_methods_class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5675f57702aa4cae6bfc1e39eb420bde inherit pub_methods_class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor"><td class="memItemLeft" align="right" valign="top">public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor.html#a5675f57702aa4cae6bfc1e39eb420bde">count_all</a> ()</td></tr>
<tr class="separator:a5675f57702aa4cae6bfc1e39eb420bde inherit pub_methods_class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a18c6bfae797d67669e16242c2390c379 inherit pub_methods_class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor"><td class="memItemLeft" align="right" valign="top">public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor.html#a18c6bfae797d67669e16242c2390c379">fetch_all</a> ()</td></tr>
<tr class="separator:a18c6bfae797d67669e16242c2390c379 inherit pub_methods_class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aadc8dac52ad2c57bff954060d60af436 inherit pub_methods_class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor"><td class="memItemLeft" align="right" valign="top">public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor.html#aadc8dac52ad2c57bff954060d60af436">primary_key_constraint</a> ()</td></tr>
<tr class="separator:aadc8dac52ad2c57bff954060d60af436 inherit pub_methods_class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a29854e14eb6854bc6871db82fdb89d1f inherit pub_methods_class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor"><td class="memItemLeft" align="right" valign="top">public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor.html#a29854e14eb6854bc6871db82fdb89d1f">fetch_by_dbID</a> ()</td></tr>
<tr class="separator:a29854e14eb6854bc6871db82fdb89d1f inherit pub_methods_class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1e7b244d27dcc1244453f725d81d3e54 inherit pub_methods_class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor"><td class="memItemLeft" align="right" valign="top">public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor.html#a1e7b244d27dcc1244453f725d81d3e54">remove_all</a> ()</td></tr>
<tr class="separator:a1e7b244d27dcc1244453f725d81d3e54 inherit pub_methods_class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab19a4a6d447c8661574a97ae159234f3 inherit pub_methods_class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor"><td class="memItemLeft" align="right" valign="top">public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor.html#ab19a4a6d447c8661574a97ae159234f3">remove</a> ()</td></tr>
<tr class="separator:ab19a4a6d447c8661574a97ae159234f3 inherit pub_methods_class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab8f4cc3813b7d1ad259b02e4a24112f2 inherit pub_methods_class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor"><td class="memItemLeft" align="right" valign="top">public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor.html#ab8f4cc3813b7d1ad259b02e4a24112f2">update</a> ()</td></tr>
<tr class="separator:ab8f4cc3813b7d1ad259b02e4a24112f2 inherit pub_methods_class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a73ed3c029cb8e6ba86cfd3159de577b2 inherit pub_methods_class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor"><td class="memItemLeft" align="right" valign="top">public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor.html#a73ed3c029cb8e6ba86cfd3159de577b2">check_object_present_in_db</a> ()</td></tr>
<tr class="separator:a73ed3c029cb8e6ba86cfd3159de577b2 inherit pub_methods_class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a23e67bcbf6294126212da34c0c5a2a90 inherit pub_methods_class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor"><td class="memItemLeft" align="right" valign="top">public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor.html#a23e67bcbf6294126212da34c0c5a2a90">store</a> ()</td></tr>
<tr class="separator:a23e67bcbf6294126212da34c0c5a2a90 inherit pub_methods_class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeac6bf08072f89a153165ea39b8ed7a1 inherit pub_methods_class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor"><td class="memItemLeft" align="right" valign="top">public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor.html#aeac6bf08072f89a153165ea39b8ed7a1">DESTROY</a> ()</td></tr>
<tr class="separator:aeac6bf08072f89a153165ea39b8ed7a1 inherit pub_methods_class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4805f85a21ec6b85814f32312ee36711 inherit pub_methods_class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor"><td class="memItemLeft" align="right" valign="top">public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor.html#a4805f85a21ec6b85814f32312ee36711">AUTOLOAD</a> ()</td></tr>
<tr class="separator:a4805f85a21ec6b85814f32312ee36711 inherit pub_methods_class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><h1><a class="anchor" id="Description"></a>
Description</h1>
 <pre>
    The Queen of the Hive based job control system is responsible to 'birthing' the
    correct number of workers of the right type so that they can find jobs to do.
    It will also free up jobs of Workers that died unexpectantly so that other workers
    can claim them to do.

    Hive based processing is a concept based on a more controlled version
    of an autonomous agent type system.  Each worker is not told what to do
    (like a centralized control system - like the current pipeline system)
    but rather queries a central database for jobs (give me jobs).

    Each worker is linked to an analysis_id, registers its self on creation
    into the Hive, creates a RunnableDB instance of the Analysis->module,
    gets $analysis->stats->batch_size jobs from the job table, does its work,
    creates the next layer of job entries by interfacing to
    the DataflowRuleAdaptor to determine the analyses it needs to pass its
    output data to and creates jobs on the next analysis database.
    It repeats this cycle until it has lived its lifetime or until there are no
    more jobs left.
    The lifetime limit is just a safety limit to prevent these from 'infecting'
    a system.

    The Queens job is to simply birth Workers of the correct analysis_id to get the
    work down.  The only other thing the Queen does is free up jobs that were
    claimed by Workers that died unexpectantly so that other workers can take
    over the work.

    The Beekeeper is in charge of interfacing between the Queen and a compute resource
    or 'compute farm'.  Its job is to query Queens if they need any workers and to
    send the requested number of workers to open machines via the runWorker.pl script.
    It is also responsible for interfacing with the Queen to identify worker which died
    unexpectantly.

</pre> </div><h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="a020be70f3da4eca961fef537e68daca6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public Bio::EnsEMBL::Hive::Queen::check_for_dead_workers </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Undocumented method</p>
<div id="codesection-check_for_dead_workers" class="dynheader closed" style="cursor:pointer;" onclick="return toggleVisibility(this)">  
    <img id='codesection-check_for_dead_workers-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-check_for_dead_workers-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-check_for_dead_workers-content' class='dyncontent' style='display: none;'> 
 <div class="fragment"><div class="line">sub <a class="code" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_queen.html#a020be70f3da4eca961fef537e68daca6">check_for_dead_workers</a> {    # scans the whole Valley <span class="keywordflow">for</span> lost Workers (but ignores unreachagle ones)</div>
<div class="line">    my ($self, $valley, $check_buried_in_haste) = @_;</div>
<div class="line"></div>
<div class="line">    warn <span class="stringliteral">&quot;GarbageCollector:\tChecking for lost Workers...\n&quot;</span>;</div>
<div class="line"></div>
<div class="line">    my $last_few_seconds            = 5;    # FIXME: It is probably a good idea to expose <span class="keyword">this</span> parameter <span class="keywordflow">for</span> easier tuning.</div>
<div class="line">    my $queen_overdue_workers       = $self-&gt;fetch_overdue_workers( $last_few_seconds );    # check the workers we have not seen active during the $last_few_seconds</div>
<div class="line">    my %mt_and_pid_to_worker_status = ();</div>
<div class="line">    my %worker_status_counts        = ();</div>
<div class="line">    my %mt_and_pid_to_lost_worker   = ();</div>
<div class="line"></div>
<div class="line">    warn <span class="stringliteral">&quot;GarbageCollector:\t[Queen:] out of &quot;</span>.scalar(@$queen_overdue_workers).<span class="stringliteral">&quot; Workers that haven&#39;t checked in during the last $last_few_seconds seconds...\n&quot;</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">foreach</span> my $worker (@$queen_overdue_workers) {</div>
<div class="line"></div>
<div class="line">        my $meadow_type = $worker-&gt;meadow_type;</div>
<div class="line">        <span class="keywordflow">if</span>(my $meadow = $valley-&gt;find_available_meadow_responsible_for_worker($worker)) {</div>
<div class="line">            $mt_and_pid_to_worker_status{$meadow_type} ||= $meadow-&gt;status_of_all_our_workers;</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            $worker_status_counts{$meadow_type}{<span class="stringliteral">&#39;UNREACHABLE&#39;</span>}++;</div>
<div class="line"></div>
<div class="line">            next;   # Worker is unreachable from <span class="keyword">this</span> Valley</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        my $process_id = $worker-&gt;process_id;</div>
<div class="line">        <span class="keywordflow">if</span>(my $status = $mt_and_pid_to_worker_status{$meadow_type}{$process_id}) { # can be RUN|PEND|xSUSP</div>
<div class="line">            $worker_status_counts{$meadow_type}{$status}++;</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            $worker_status_counts{$meadow_type}{<span class="stringliteral">&#39;LOST&#39;</span>}++;</div>
<div class="line"></div>
<div class="line">            $mt_and_pid_to_lost_worker{$meadow_type}{$process_id} = $worker;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">        # just a quick summary report:</span></div>
<div class="line"><span class="preprocessor"></span>    <span class="keywordflow">foreach</span> my $meadow_type (keys %worker_status_counts) {</div>
<div class="line">        warn <span class="stringliteral">&quot;GarbageCollector:\t[$meadow_type Meadow:]\t&quot;</span>.join(<span class="stringliteral">&#39;, &#39;</span>, map { <span class="stringliteral">&quot;$_:$worker_status_counts{$meadow_type}{$_}&quot;</span> } keys %{$worker_status_counts{$meadow_type}}).<span class="stringliteral">&quot;\n\n&quot;</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">while</span>(my ($meadow_type, $pid_to_lost_worker) = each %mt_and_pid_to_lost_worker) {</div>
<div class="line">        my $this_meadow = $valley-&gt;available_meadow_hash-&gt;{$meadow_type};</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span>(my $lost_this_meadow = scalar(keys %$pid_to_lost_worker) ) {</div>
<div class="line">            warn <span class="stringliteral">&quot;GarbageCollector:\tDiscovered $lost_this_meadow lost $meadow_type Workers\n&quot;</span>;</div>
<div class="line"></div>
<div class="line">            my $wpid_to_cod = {};</div>
<div class="line">            <span class="keywordflow">if</span>($this_meadow-&gt;can(<span class="stringliteral">&#39;find_out_causes&#39;</span>)) {</div>
<div class="line">                $wpid_to_cod = $this_meadow-&gt;find_out_causes( keys %$pid_to_lost_worker );</div>
<div class="line">                my $lost_with_known_cod = scalar(keys %$wpid_to_cod);</div>
<div class="line">                warn <span class="stringliteral">&quot;GarbageCollector:\tFound why $lost_with_known_cod of $meadow_type Workers died\n&quot;</span>;</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                warn <span class="stringliteral">&quot;GarbageCollector:\t$meadow_type meadow does not support post-mortem examination\n&quot;</span>;</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            warn <span class="stringliteral">&quot;GarbageCollector:\tReleasing the jobs\n&quot;</span>;</div>
<div class="line">            <span class="keywordflow">while</span>(my ($process_id, $worker) = each %$pid_to_lost_worker) {</div>
<div class="line">                $worker-&gt;cause_of_death( $wpid_to_cod-&gt;{$process_id} || <span class="stringliteral">&#39;UNKNOWN&#39;</span>);</div>
<div class="line">                $self-&gt;register_worker_death($worker);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">        # the following bit is completely Meadow-agnostic and only restores database integrity:</span></div>
<div class="line"><span class="preprocessor"></span>    <span class="keywordflow">if</span>($check_buried_in_haste) {</div>
<div class="line">        warn <span class="stringliteral">&quot;GarbageCollector:\tChecking for Workers buried in haste...\n&quot;</span>;</div>
<div class="line">        my $buried_in_haste_list = $self-&gt;fetch_all_dead_workers_with_jobs();</div>
<div class="line">        <span class="keywordflow">if</span>(my $bih_number = scalar(@$buried_in_haste_list)) {</div>
<div class="line">            warn <span class="stringliteral">&quot;GarbageCollector:\tfound $bih_number jobs, reclaiming.\n\n&quot;</span>;</div>
<div class="line">            <span class="keywordflow">if</span>($bih_number) {</div>
<div class="line">                my $job_adaptor = $self-&gt;db-&gt;get_AnalysisJobAdaptor();</div>
<div class="line">                <span class="keywordflow">foreach</span> my $worker (@$buried_in_haste_list) {</div>
<div class="line">                    $job_adaptor-&gt;release_undone_jobs_from_worker($worker);</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            warn <span class="stringliteral">&quot;GarbageCollector:\tfound none\n&quot;</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --> </div> 
</div>
</div>
<a class="anchor" id="a8ec0da9cd78a6fc994786f65b8710a7d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public Bio::EnsEMBL::Hive::Queen::check_in_worker </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Undocumented method</p>
<div id="codesection-check_in_worker" class="dynheader closed" style="cursor:pointer;" onclick="return toggleVisibility(this)">  
    <img id='codesection-check_in_worker-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-check_in_worker-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-check_in_worker-content' class='dyncontent' style='display: none;'> 
 <div class="fragment"><div class="line">sub <a class="code" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_queen.html#a8ec0da9cd78a6fc994786f65b8710a7d">check_in_worker</a> {</div>
<div class="line">    my ($self, $worker) = @_;</div>
<div class="line"></div>
<div class="line">    $self-&gt;dbc-&gt;do(<span class="stringliteral">&quot;UPDATE worker SET last_check_in=CURRENT_TIMESTAMP, status=&#39;&quot;</span>.$worker-&gt;status.<span class="stringliteral">&quot;&#39;, work_done=&#39;&quot;</span>.$worker-&gt;work_done.<span class="stringliteral">&quot;&#39; WHERE worker_id=&#39;&quot;</span>.$worker-&gt;dbID.<span class="stringliteral">&quot;&#39;&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment --> </div> 
</div>
</div>
<a class="anchor" id="afbb012326e074b38548ac7341404774b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public Bio::EnsEMBL::Hive::Queen::count_running_workers </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Undocumented method</p>
<div id="codesection-count_running_workers" class="dynheader closed" style="cursor:pointer;" onclick="return toggleVisibility(this)">  
    <img id='codesection-count_running_workers-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-count_running_workers-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-count_running_workers-content' class='dyncontent' style='display: none;'> 
 <div class="fragment"><div class="line">sub <a class="code" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_queen.html#afbb012326e074b38548ac7341404774b">count_running_workers</a> {</div>
<div class="line">    my ($self, $analysis_id) = @_;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> $self-&gt;count_all( <span class="stringliteral">&quot;status!=&#39;DEAD&#39;&quot;</span>.($analysis_id ? <span class="stringliteral">&quot; AND analysis_id=$analysis_id&quot;</span> : <span class="stringliteral">&#39;&#39;</span>) );</div>
<div class="line">}</div>
</div><!-- fragment --> </div> 
</div>
</div>
<a class="anchor" id="a9cd9baa52f9e7a2240ffb979518cfee1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public <a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_worker.html">Bio::EnsEMBL::Hive::Worker</a> Bio::EnsEMBL::Hive::Queen::create_new_worker </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre>
  Description: Creates an entry in the worker table,
               populates some non-storable attributes
               and returns a <a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_worker.html">Worker</a> object based on that insert.
               This guarantees that each worker registered in this <a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_queen.html">Queen</a>'s hive is properly registered.
  Returntype : <a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_worker.html">Bio::EnsEMBL::Hive::Worker</a>
  Caller     : <a class="el" href="run_worker_8pl.html">runWorker.pl</a></pre><pre> </pre><div id="codesection-create_new_worker" class="dynheader closed" style="cursor:pointer;" onclick="return toggleVisibility(this)">  
    <img id='codesection-create_new_worker-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-create_new_worker-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-create_new_worker-content' class='dyncontent' style='display: none;'> 
 <div class="fragment"><div class="line">sub <a class="code" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_queen.html#a9cd9baa52f9e7a2240ffb979518cfee1">create_new_worker</a> {</div>
<div class="line">    my ($self, @args) = @_;</div>
<div class="line"></div>
<div class="line">    my ($meadow_type, $meadow_name, $process_id, $exec_host, $resource_class_id, $resource_class_name,</div>
<div class="line">        $no_write, $debug, $worker_log_dir, $hive_log_dir, $job_limit, $life_span, $no_cleanup, $retry_throwing_jobs, $can_respecialize) =</div>
<div class="line"></div>
<div class="line">    rearrange([qw(meadow_type meadow_name process_id exec_host resource_class_id resource_class_name</div>
<div class="line">                no_write debug worker_log_dir hive_log_dir job_limit life_span no_cleanup retry_throwing_jobs can_respecialize) ], @args);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">foreach</span> my $prev_worker_incarnation (@{ $self-&gt;fetch_all( <span class="stringliteral">&quot;status!=&#39;DEAD&#39; AND meadow_type=&#39;$meadow_type&#39; AND meadow_name=&#39;$meadow_name&#39; AND process_id=&#39;$process_id&#39;&quot;</span> ) }) {</div>
<div class="line"><span class="preprocessor">            # so far &#39;RELOCATED events&#39; has been detected on LSF 9.0 in response to sending signal #99 or #100</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">            # Since I don&#39;t know how to avoid them, I am trying to register them when they happen.</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">            # The following snippet buries the previous incarnation of the Worker before starting a new one.</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">            #</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">            # FIXME: if GarabageCollector (beekeeper -dead) gets to these processes first, it will register them as DEAD/UNKNOWN.</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">            #       LSF 9.0 does not report &quot;rescheduling&quot; events in the output of &#39;bacct&#39;, but does mention them in &#39;bhist&#39;.</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">            #       So parsing &#39;bhist&#39; output would probably yield the most accurate &amp; confident registration of these events.</span></div>
<div class="line"><span class="preprocessor"></span>        $prev_worker_incarnation-&gt;cause_of_death( <span class="stringliteral">&#39;RELOCATED&#39;</span> );</div>
<div class="line">        $self-&gt;register_worker_death( $prev_worker_incarnation );</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>( defined($resource_class_name) ) {</div>
<div class="line">        my $rc = $self-&gt;db-&gt;get_ResourceClassAdaptor-&gt;fetch_by_name($resource_class_name)</div>
<div class="line">            or die <span class="stringliteral">&quot;resource_class with name=&#39;$resource_class_name&#39; could not be fetched from the database&quot;</span>;</div>
<div class="line"></div>
<div class="line">        $resource_class_id = $rc-&gt;dbID;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    my $sql = q{INSERT INTO worker (born, last_check_in, meadow_type, meadow_name, host, process_id, resource_class_id)</div>
<div class="line">              VALUES (CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?, ?, ?, ?)};</div>
<div class="line"></div>
<div class="line">    my $sth = $self-&gt;prepare($sql);</div>
<div class="line">    $sth-&gt;execute($meadow_type, $meadow_name, $exec_host, $process_id, $resource_class_id);</div>
<div class="line">    my $worker_id = $self-&gt;dbc-&gt;db_handle-&gt;last_insert_id(undef, undef, &#39;worker&#39;, &#39;worker_id&#39;)</div>
<div class="line">        or die &quot;Could not insert a new worker&quot;;</div>
<div class="line">    $sth-&gt;finish;</div>
<div class="line"></div>
<div class="line">    my $worker = $self-&gt;<a class="code" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor.html#a29854e14eb6854bc6871db82fdb89d1f">fetch_by_dbID</a>($worker_id)</div>
<div class="line">        or die &quot;Could not fetch worker with dbID=$worker_id&quot;;</div>
<div class="line"></div>
<div class="line">    if($hive_log_dir or $worker_log_dir) {</div>
<div class="line">        my $dir_revhash = dir_revhash($worker_id);</div>
<div class="line">        $worker_log_dir ||= $hive_log_dir .<span class="charliteral">&#39;/&#39;</span>. ($dir_revhash ? <span class="stringliteral">&quot;$dir_revhash/&quot;</span> : <span class="stringliteral">&#39;&#39;</span>) .<span class="stringliteral">&#39;worker_id_&#39;</span>.$worker_id;</div>
<div class="line"></div>
<div class="line">        eval {</div>
<div class="line">            make_path( $worker_log_dir );</div>
<div class="line">            1;</div>
</div><!-- fragment --> </div> 
</div>
</div>
<a class="anchor" id="ab0c7e6cbb62054c0076d73a52efe9141"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public Bio::EnsEMBL::Hive::Queen::default_insertion_method </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Undocumented method</p>
<div id="codesection-default_insertion_method" class="dynheader closed" style="cursor:pointer;" onclick="return toggleVisibility(this)">  
    <img id='codesection-default_insertion_method-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-default_insertion_method-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-default_insertion_method-content' class='dyncontent' style='display: none;'> 
 <div class="fragment"><div class="line">sub <a class="code" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_queen.html#ab0c7e6cbb62054c0076d73a52efe9141">default_insertion_method</a> {</div>
<div class="line">    <span class="keywordflow">return</span> <span class="stringliteral">&#39;INSERT&#39;</span>;</div>
<div class="line">}</div>
</div><!-- fragment --> </div> 
</div>
</div>
<a class="anchor" id="a545edfa6d9aa715376d5ed7d20767755"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public Bio::EnsEMBL::Hive::Queen::default_table_name </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Undocumented method</p>
<div id="codesection-default_table_name" class="dynheader closed" style="cursor:pointer;" onclick="return toggleVisibility(this)">  
    <img id='codesection-default_table_name-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-default_table_name-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-default_table_name-content' class='dyncontent' style='display: none;'> 
 <div class="fragment"><div class="line">sub <a class="code" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_queen.html#a545edfa6d9aa715376d5ed7d20767755">default_table_name</a> {</div>
<div class="line">    <span class="keywordflow">return</span> <span class="stringliteral">&#39;worker&#39;</span>;</div>
<div class="line">}</div>
</div><!-- fragment --> </div> 
</div>
</div>
<a class="anchor" id="a1ec8aba875ab47959d2714b32b04a5d2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public Bio::EnsEMBL::Hive::Queen::fetch_all_dead_workers_with_jobs </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Undocumented method</p>
<div id="codesection-fetch_all_dead_workers_with_jobs" class="dynheader closed" style="cursor:pointer;" onclick="return toggleVisibility(this)">  
    <img id='codesection-fetch_all_dead_workers_with_jobs-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-fetch_all_dead_workers_with_jobs-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-fetch_all_dead_workers_with_jobs-content' class='dyncontent' style='display: none;'> 
 <div class="fragment"><div class="line">sub <a class="code" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_queen.html#a1ec8aba875ab47959d2714b32b04a5d2">fetch_all_dead_workers_with_jobs</a> {</div>
<div class="line">    my $self = shift;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> $self-&gt;fetch_all( <span class="stringliteral">&quot;JOIN job j USING(worker_id) WHERE worker.status=&#39;DEAD&#39; AND j.status NOT IN (&#39;DONE&#39;, &#39;READY&#39;, &#39;FAILED&#39;, &#39;PASSED_ON&#39;) GROUP BY worker_id&quot;</span> );</div>
<div class="line">}</div>
</div><!-- fragment --> </div> 
</div>
</div>
<a class="anchor" id="a47b088cb6be9493e6853b5ee0b20b522"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public Bio::EnsEMBL::Hive::Queen::fetch_overdue_workers </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Undocumented method</p>
<div id="codesection-fetch_overdue_workers" class="dynheader closed" style="cursor:pointer;" onclick="return toggleVisibility(this)">  
    <img id='codesection-fetch_overdue_workers-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-fetch_overdue_workers-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-fetch_overdue_workers-content' class='dyncontent' style='display: none;'> 
 <div class="fragment"><div class="line">sub <a class="code" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_queen.html#a47b088cb6be9493e6853b5ee0b20b522">fetch_overdue_workers</a> {</div>
<div class="line">    my ($self,$overdue_secs) = @_;</div>
<div class="line"></div>
<div class="line">    $overdue_secs = 3600 unless(defined($overdue_secs));</div>
<div class="line"></div>
<div class="line">    my $constraint = <span class="stringliteral">&quot;status!=&#39;DEAD&#39; AND &quot;</span>.{</div>
<div class="line">            <span class="stringliteral">&#39;mysql&#39;</span>     =&gt;  <span class="stringliteral">&quot;(UNIX_TIMESTAMP()-UNIX_TIMESTAMP(last_check_in)) &gt; $overdue_secs&quot;</span>,</div>
<div class="line">            <span class="stringliteral">&#39;sqlite&#39;</span>    =&gt;  <span class="stringliteral">&quot;(strftime(&#39;%s&#39;,&#39;now&#39;)-strftime(&#39;%s&#39;,last_check_in)) &gt; $overdue_secs&quot;</span>,</div>
<div class="line">            <span class="stringliteral">&#39;pgsql&#39;</span>     =&gt;  <span class="stringliteral">&quot;EXTRACT(EPOCH FROM CURRENT_TIMESTAMP - last_check_in) &gt; $overdue_secs&quot;</span>,</div>
<div class="line">        }-&gt;{ $self-&gt;dbc-&gt;driver };</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> $self-&gt;fetch_all( $constraint );</div>
<div class="line">}</div>
</div><!-- fragment --> </div> 
</div>
</div>
<a class="anchor" id="abe36b590f923d7e82d3577f484bd6056"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public Bio::EnsEMBL::Hive::Queen::get_hive_current_load </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Undocumented method</p>
<div id="codesection-get_hive_current_load" class="dynheader closed" style="cursor:pointer;" onclick="return toggleVisibility(this)">  
    <img id='codesection-get_hive_current_load-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-get_hive_current_load-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-get_hive_current_load-content' class='dyncontent' style='display: none;'> 
 <div class="fragment"><div class="line">sub <a class="code" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_queen.html#abe36b590f923d7e82d3577f484bd6056">get_hive_current_load</a> {</div>
<div class="line">    my $self = shift;</div>
<div class="line">    my $sql = qq{</div>
<div class="line">        SELECT sum(1/hive_capacity)</div>
<div class="line">        FROM worker w</div>
<div class="line">        JOIN analysis_stats USING(analysis_id)</div>
<div class="line">        WHERE w.status!=&#39;DEAD&#39;</div>
<div class="line">        AND hive_capacity IS NOT NULL</div>
<div class="line">        AND hive_capacity&gt;0</div>
<div class="line">    };</div>
<div class="line">    my $sth = $self-&gt;prepare($sql);</div>
<div class="line">    $sth-&gt;execute();</div>
<div class="line">    my ($load)=$sth-&gt;fetchrow_array();</div>
<div class="line">    $sth-&gt;finish;</div>
<div class="line">    return ($load || 0);</div>
<div class="line">}</div>
</div><!-- fragment --> </div> 
</div>
</div>
<a class="anchor" id="afdadb6fce4eb7469f6de433612867dd5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public Int Bio::EnsEMBL::Hive::Queen::get_num_failed_analyses </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre>
  Arg [1]    : <a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_analysis_stats.html">Bio::EnsEMBL::Hive::AnalysisStats</a> object (optional)
  Example    :</pre><div class="fragment"><div class="line"><span class="keywordflow">if</span>( $self-&gt;get_num_failed_analyses( $my_analysis )) { do_something; }</div>
</div><!-- fragment --> <pre>  Example    :</pre><div class="fragment"><div class="line">my $num_failed_analyses = $self-&gt;get_num_failed_analyses();</div>
</div><!-- fragment --> <pre>  Description: Reports all failed analyses and returns
                either the number of total failed (if no $filter_analysis was provided)
                or 1/0, depending on whether $filter_analysis failed or not.
  Returntype : int
  Exceptions : none
  Caller     : general</pre><pre> </pre><div id="codesection-get_num_failed_analyses" class="dynheader closed" style="cursor:pointer;" onclick="return toggleVisibility(this)">  
    <img id='codesection-get_num_failed_analyses-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-get_num_failed_analyses-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-get_num_failed_analyses-content' class='dyncontent' style='display: none;'> 
 <div class="fragment"><div class="line">sub <a class="code" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_queen.html#afdadb6fce4eb7469f6de433612867dd5">get_num_failed_analyses</a> {</div>
<div class="line">    my ($self, $filter_analysis) = @_;</div>
<div class="line"></div>
<div class="line">    my $failed_analyses = $self-&gt;db-&gt;get_AnalysisAdaptor-&gt;fetch_all_failed_analyses();</div>
<div class="line"></div>
<div class="line">    my $filter_analysis_failed = 0;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">foreach</span> my $failed_analysis (@$failed_analyses) {</div>
<div class="line">        print <span class="stringliteral">&quot;\t##########################################################\n&quot;</span>;</div>
<div class="line">        print <span class="stringliteral">&quot;\t# Too many jobs in analysis &#39;&quot;</span>.$failed_analysis-&gt;logic_name.<span class="stringliteral">&quot;&#39; FAILED #\n&quot;</span>;</div>
<div class="line">        print <span class="stringliteral">&quot;\t##########################################################\n\n&quot;</span>;</div>
<div class="line">        <span class="keywordflow">if</span>($filter_analysis and ($filter_analysis-&gt;dbID == $failed_analysis)) {</div>
<div class="line">            $filter_analysis_failed = 1;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> $filter_analysis ? $filter_analysis_failed : scalar(@$failed_analyses);</div>
<div class="line">}</div>
</div><!-- fragment --> </div> 
</div>
</div>
<a class="anchor" id="a51b365aa339df1f733167970be158c63"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public Bio::EnsEMBL::Hive::Queen::get_remaining_jobs_show_hive_progress </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Undocumented method</p>
<div id="codesection-get_remaining_jobs_show_hive_progress" class="dynheader closed" style="cursor:pointer;" onclick="return toggleVisibility(this)">  
    <img id='codesection-get_remaining_jobs_show_hive_progress-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-get_remaining_jobs_show_hive_progress-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-get_remaining_jobs_show_hive_progress-content' class='dyncontent' style='display: none;'> 
 <div class="fragment"><div class="line">sub <a class="code" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_queen.html#a51b365aa339df1f733167970be158c63">get_remaining_jobs_show_hive_progress</a> {</div>
<div class="line">  my $self = shift;</div>
<div class="line">  my $sql = <span class="stringliteral">&quot;SELECT sum(done_job_count), sum(failed_job_count), sum(total_job_count), &quot;</span>.</div>
<div class="line">            <span class="stringliteral">&quot;sum(ready_job_count * analysis_stats.avg_msec_per_job)/1000/60/60 &quot;</span>.</div>
<div class="line">            <span class="stringliteral">&quot;FROM analysis_stats&quot;</span>;</div>
<div class="line">  my $sth = $self-&gt;prepare($sql);</div>
<div class="line">  $sth-&gt;execute();</div>
<div class="line">  my ($done, $failed, $total, $cpuhrs) = $sth-&gt;fetchrow_array();</div>
<div class="line">  $sth-&gt;finish;</div>
<div class="line"></div>
<div class="line">  $done   ||= 0;</div>
<div class="line">  $failed ||= 0;</div>
<div class="line">  $total  ||= 0;</div>
<div class="line">  my $completed = $total</div>
<div class="line">    ? ((100.0 * ($done+$failed))/$total)</div>
<div class="line">    : 0.0;</div>
<div class="line">  my $remaining = $total - $done - $failed;</div>
<div class="line">  warn sprintf(<span class="stringliteral">&quot;hive %1.3f%% complete (&lt; %1.3f CPU_hrs) (%d todo + %d done + %d failed = %d total)\n&quot;</span>,</div>
<div class="line">          $completed, $cpuhrs, $remaining, $done, $failed, $total);</div>
<div class="line">  <span class="keywordflow">return</span> $remaining;</div>
<div class="line">}</div>
</div><!-- fragment --> </div> 
</div>
</div>
<a class="anchor" id="ad5392456810e1f4bb16291b54a731c0a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public Bio::EnsEMBL::Hive::Queen::get_workers_rank </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Undocumented method</p>
<div id="codesection-get_workers_rank" class="dynheader closed" style="cursor:pointer;" onclick="return toggleVisibility(this)">  
    <img id='codesection-get_workers_rank-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-get_workers_rank-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-get_workers_rank-content' class='dyncontent' style='display: none;'> 
 <div class="fragment"><div class="line">sub <a class="code" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_queen.html#ad5392456810e1f4bb16291b54a731c0a">get_workers_rank</a> {</div>
<div class="line">    my ($self, $worker) = @_;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> $self-&gt;count_all( <span class="stringliteral">&quot;status!=&#39;DEAD&#39; AND analysis_id=&quot;</span>.$worker-&gt;analysis_id.<span class="stringliteral">&quot; AND worker_id&lt;&quot;</span>.$worker-&gt;dbID );</div>
<div class="line">}</div>
</div><!-- fragment --> </div> 
</div>
</div>
<a class="anchor" id="a422e896db7c973b0385bbafd2c8aa556"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public Bio::EnsEMBL::Hive::Queen::monitor </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre>
  Arg[1]     : --none--
  Example    :</pre><div class="fragment"><div class="line">$queen-&gt;monitor();</div>
</div><!-- fragment --> <pre>  Description: Monitors current throughput and store the result in the monitor
               table
  Exceptions : none
  Caller     : beekeepers and other external processes</pre><pre> </pre><div id="codesection-monitor" class="dynheader closed" style="cursor:pointer;" onclick="return toggleVisibility(this)">  
    <img id='codesection-monitor-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-monitor-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-monitor-content' class='dyncontent' style='display: none;'> 
 <div class="fragment"><div class="line">sub <a class="code" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_queen.html#a422e896db7c973b0385bbafd2c8aa556">monitor</a> {</div>
<div class="line">    my $self = shift;</div>
<div class="line">    my $sql = qq{</div>
<div class="line">        INSERT INTO <a class="code" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_queen.html#a422e896db7c973b0385bbafd2c8aa556">monitor</a></div>
<div class="line">        SELECT CURRENT_TIMESTAMP, count(*),</div>
<div class="line">    } . {</div>
<div class="line">        <span class="stringliteral">&#39;mysql&#39;</span>     =&gt;  qq{ sum(work_done/(UNIX_TIMESTAMP()-UNIX_TIMESTAMP(born))),</div>
<div class="line">                            sum(work_done/(UNIX_TIMESTAMP()-UNIX_TIMESTAMP(born)))/count(*), },</div>
<div class="line">        <span class="stringliteral">&#39;sqlite&#39;</span>    =&gt;  qq{ sum(work_done/(strftime(<span class="stringliteral">&#39;%s&#39;</span>,<span class="stringliteral">&#39;now&#39;</span>)-strftime(<span class="stringliteral">&#39;%s&#39;</span>,born))),</div>
<div class="line">                            sum(work_done/(strftime(<span class="stringliteral">&#39;%s&#39;</span>,<span class="stringliteral">&#39;now&#39;</span>)-strftime(<span class="stringliteral">&#39;%s&#39;</span>,born)))/count(*), },</div>
<div class="line">        <span class="stringliteral">&#39;pgsql&#39;</span>     =&gt;  qq{ sum(work_done/(EXTRACT(EPOCH FROM CURRENT_TIMESTAMP - born))),</div>
<div class="line">                            sum(work_done/(EXTRACT(EPOCH FROM CURRENT_TIMESTAMP - born)))/count(*), },</div>
<div class="line">    }-&gt;{ $self-&gt;dbc-&gt;driver }. qq{</div>
<div class="line">        group_concat(DISTINCT logic_name)</div>
<div class="line">        FROM worker w</div>
<div class="line">        LEFT JOIN analysis_base USING (analysis_id)</div>
<div class="line">        WHERE w.status!=&#39;DEAD&#39;</div>
<div class="line">    };</div>
<div class="line">      </div>
<div class="line">  my $sth = $self-&gt;prepare($sql);</div>
<div class="line">  $sth-&gt;execute();</div>
<div class="line">}</div>
</div><!-- fragment --> </div> 
</div>
</div>
<a class="anchor" id="af9d2e010bf4d53356d2efde2367c5472"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public Bio::EnsEMBL::Hive::Queen::object_class </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Undocumented method</p>
<div id="codesection-object_class" class="dynheader closed" style="cursor:pointer;" onclick="return toggleVisibility(this)">  
    <img id='codesection-object_class-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-object_class-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-object_class-content' class='dyncontent' style='display: none;'> 
 <div class="fragment"><div class="line">sub <a class="code" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_queen.html#af9d2e010bf4d53356d2efde2367c5472">object_class</a> {</div>
<div class="line">    <span class="keywordflow">return</span> <span class="stringliteral">&#39;Bio::EnsEMBL::Hive::Worker&#39;</span>;</div>
<div class="line">}</div>
</div><!-- fragment --> </div> 
</div>
</div>
<a class="anchor" id="ad396c5be7d6806c71b5740054325d5e6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public Bio::EnsEMBL::Hive::Queen::print_analysis_status </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Undocumented method</p>
<div id="codesection-print_analysis_status" class="dynheader closed" style="cursor:pointer;" onclick="return toggleVisibility(this)">  
    <img id='codesection-print_analysis_status-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-print_analysis_status-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-print_analysis_status-content' class='dyncontent' style='display: none;'> 
 <div class="fragment"><div class="line">sub <a class="code" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_queen.html#ad396c5be7d6806c71b5740054325d5e6">print_analysis_status</a> {</div>
<div class="line">    my ($self, $filter_analysis) = @_;</div>
<div class="line"></div>
<div class="line">    my $list_of_analyses = $filter_analysis ? [$filter_analysis] : $self-&gt;db-&gt;get_AnalysisAdaptor-&gt;fetch_all;</div>
<div class="line">    <span class="keywordflow">foreach</span> my $analysis (sort {$a-&gt;dbID &lt;=&gt; $b-&gt;dbID} @$list_of_analyses) {</div>
<div class="line">        print $analysis-&gt;stats-&gt;toString . <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --> </div> 
</div>
</div>
<a class="anchor" id="af91dbe0832893ec7ec3ecc8a7f7164dd"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public Bio::EnsEMBL::Hive::Queen::print_running_worker_counts </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Undocumented method</p>
<div id="codesection-print_running_worker_counts" class="dynheader closed" style="cursor:pointer;" onclick="return toggleVisibility(this)">  
    <img id='codesection-print_running_worker_counts-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-print_running_worker_counts-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-print_running_worker_counts-content' class='dyncontent' style='display: none;'> 
 <div class="fragment"><div class="line">sub <a class="code" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_queen.html#af91dbe0832893ec7ec3ecc8a7f7164dd">print_running_worker_counts</a> {</div>
<div class="line">    my $self = shift;</div>
<div class="line"></div>
<div class="line">    my $sql = qq{</div>
<div class="line">        SELECT logic_name, count(*)</div>
<div class="line">        FROM worker w</div>
<div class="line">        JOIN analysis_base a USING(analysis_id)</div>
<div class="line">        WHERE w.status!=&#39;DEAD&#39;</div>
<div class="line">        GROUP BY a.analysis_id</div>
<div class="line">    };</div>
<div class="line"></div>
<div class="line">    my $total_workers = 0;</div>
<div class="line">    my $sth = $self-&gt;prepare($sql);</div>
<div class="line">    $sth-&gt;execute();</div>
<div class="line"></div>
<div class="line">    print &quot;\n===== Stats of live Workers according to the Queen: ======\n&quot;;</div>
<div class="line">    while((my $logic_name, my $worker_count)=$sth-&gt;fetchrow_array()) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;%30s : %d workers\n&quot;</span>, $logic_name, $worker_count);</div>
<div class="line">        $total_workers += $worker_count;</div>
<div class="line">    }</div>
<div class="line">    $sth-&gt;finish;</div>
<div class="line">    printf(<span class="stringliteral">&quot;%30s : %d workers\n\n&quot;</span>, <span class="stringliteral">&#39;======= TOTAL =======&#39;</span>, $total_workers);</div>
<div class="line">}</div>
</div><!-- fragment --> </div> 
</div>
</div>
<a class="anchor" id="ab4f2cf470e0b3bbe732dd50c22e4deca"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public Bio::EnsEMBL::Hive::Queen::register_all_workers_dead </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre>
  Example    :</pre><div class="fragment"><div class="line">$queen-&gt;register_all_workers_dead();</div>
</div><!-- fragment --> <pre>  Description: Registers all workers dead
  Exceptions : none
  Caller     : beekeepers and other external processes</pre><pre> </pre><div id="codesection-register_all_workers_dead" class="dynheader closed" style="cursor:pointer;" onclick="return toggleVisibility(this)">  
    <img id='codesection-register_all_workers_dead-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-register_all_workers_dead-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-register_all_workers_dead-content' class='dyncontent' style='display: none;'> 
 <div class="fragment"><div class="line">sub <a class="code" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_queen.html#ab4f2cf470e0b3bbe732dd50c22e4deca">register_all_workers_dead</a> {</div>
<div class="line">    my $self = shift;</div>
<div class="line"></div>
<div class="line">    my $all_workers_considered_alive = $self-&gt;fetch_all( <span class="stringliteral">&quot;status!=&#39;DEAD&#39;&quot;</span> );</div>
<div class="line">    <span class="keywordflow">foreach</span> my $worker (@{$all_workers_considered_alive}) {</div>
<div class="line">        $worker-&gt;cause_of_death( <span class="stringliteral">&#39;UNKNOWN&#39;</span> );  # well, maybe we could have investigated further...</div>
<div class="line">        $self-&gt;register_worker_death($worker);</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --> </div> 
</div>
</div>
<a class="anchor" id="a1dc35ff50f5375e8796f12d17b372773"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public Bio::EnsEMBL::Hive::Queen::register_worker_death </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Undocumented method</p>
<div id="codesection-register_worker_death" class="dynheader closed" style="cursor:pointer;" onclick="return toggleVisibility(this)">  
    <img id='codesection-register_worker_death-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-register_worker_death-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-register_worker_death-content' class='dyncontent' style='display: none;'> 
 <div class="fragment"><div class="line">sub <a class="code" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_queen.html#a1dc35ff50f5375e8796f12d17b372773">register_worker_death</a> {</div>
<div class="line">    my ($self, $worker, $self_burial) = @_;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> unless($worker);</div>
<div class="line"></div>
<div class="line">    my $cod = $worker-&gt;cause_of_death() || <span class="stringliteral">&#39;UNKNOWN&#39;</span>;    # make sure we <span class="keywordflow">do</span> not attempt to insert a <span class="keywordtype">void</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">                    # FIXME: make it possible to set the &#39;died&#39; timestamp if we have detected it from logs:</span></div>
<div class="line"><span class="preprocessor"></span>    my $sql = qq{UPDATE worker SET died=CURRENT_TIMESTAMP</div>
<div class="line">    } . ( $self_burial ? <span class="stringliteral">&#39;,last_check_in=CURRENT_TIMESTAMP &#39;</span> : <span class="stringliteral">&#39;&#39;</span>) . qq{</div>
<div class="line">                    ,status=<span class="stringliteral">&#39;DEAD&#39;</span></div>
<div class="line">                    ,work_done=<span class="stringliteral">&#39;}. $worker-&gt;work_done . qq{&#39;</span></div>
<div class="line">                    ,cause_of_death=<span class="stringliteral">&#39;$cod&#39;</span></div>
<div class="line">                WHERE worker_id=<span class="stringliteral">&#39;}. $worker-&gt;dbID . qq{&#39;</span>};</div>
<div class="line">    $self-&gt;dbc-&gt;do( $sql );</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(my $analysis_id = $worker-&gt;analysis_id) {</div>
<div class="line">        my $analysis_stats_adaptor = $self-&gt;db-&gt;get_AnalysisStatsAdaptor;</div>
<div class="line"></div>
<div class="line">        unless( $self-&gt;db-&gt;hive_use_triggers() ) {</div>
<div class="line">            $analysis_stats_adaptor-&gt;decrease_running_workers($worker-&gt;analysis_id);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        unless( $cod eq <span class="stringliteral">&#39;NO_WORK&#39;</span></div>
<div class="line">            or  $cod eq <span class="stringliteral">&#39;JOB_LIMIT&#39;</span></div>
<div class="line">            or  $cod eq <span class="stringliteral">&#39;HIVE_OVERLOAD&#39;</span></div>
<div class="line">            or  $cod eq <span class="stringliteral">&#39;LIFESPAN&#39;</span></div>
<div class="line">        ) {</div>
<div class="line">                $self-&gt;db-&gt;get_AnalysisJobAdaptor-&gt;release_undone_jobs_from_worker($worker);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">            # re-sync the analysis_stats when a worker dies as part of dynamic sync system</span></div>
<div class="line"><span class="preprocessor"></span>        <span class="keywordflow">if</span>($self-&gt;safe_synchronize_AnalysisStats($worker-&gt;analysis-&gt;stats)-&gt;status ne <span class="stringliteral">&#39;DONE&#39;</span>) {</div>
<div class="line"><span class="preprocessor">            # since I&#39;m dying I should make sure there is someone to take my place after I&#39;m gone ...</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">            # above synch still sees me as a &#39;living worker&#39; so I need to compensate for that</span></div>
<div class="line"><span class="preprocessor"></span>            $analysis_stats_adaptor-&gt;increase_required_workers($worker-&gt;analysis_id);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --> </div> 
</div>
</div>
<a class="anchor" id="a46f196406a5bd9c452a5f94361a2eebd"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public void Bio::EnsEMBL::Hive::Queen::reset_job_by_dbID_and_sync </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre>
  Arg [1]: int $job_id
  Example: 
    my $job = $queen-&gt;reset_job_by_dbID_and_sync($job_id);
  Description: 
    For the specified job_id it will fetch just that job, 
    reset it completely as if it has never run, and return it.  
    Specifying a specific job bypasses the safety checks, 
    thus multiple workers could be running the 
    same job simultaneously (use only for debugging).
  Returntype : none
  Exceptions :
  Caller     : <a class="el" href="beekeeper_8pl.html">beekeeper.pl</a></pre><pre> </pre><div id="codesection-reset_job_by_dbID_and_sync" class="dynheader closed" style="cursor:pointer;" onclick="return toggleVisibility(this)">  
    <img id='codesection-reset_job_by_dbID_and_sync-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-reset_job_by_dbID_and_sync-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-reset_job_by_dbID_and_sync-content' class='dyncontent' style='display: none;'> 
 <div class="fragment"><div class="line">sub <a class="code" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_queen.html#a46f196406a5bd9c452a5f94361a2eebd">reset_job_by_dbID_and_sync</a> {</div>
<div class="line">    my ($self, $job_id) = @_;</div>
<div class="line"></div>
<div class="line">    my $job_adaptor = $self-&gt;db-&gt;get_AnalysisJobAdaptor;</div>
<div class="line">    my $job = $job_adaptor-&gt;reset_or_grab_job_by_dbID($job_id); </div>
<div class="line"></div>
<div class="line">    my $stats = $self-&gt;db-&gt;get_AnalysisStatsAdaptor-&gt;fetch_by_analysis_id($job-&gt;analysis_id);</div>
<div class="line">    $self-&gt;synchronize_AnalysisStats($stats);</div>
<div class="line">}</div>
</div><!-- fragment --> </div> 
</div>
</div>
<a class="anchor" id="abe0354cbdbf898d95cf08cb2d167ba38"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public Bio::EnsEMBL::Hive::Queen::safe_synchronize_AnalysisStats </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre>
  Arg [1]    : <a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_analysis_stats.html">Bio::EnsEMBL::Hive::AnalysisStats</a> object
  Example    :</pre><div class="fragment"><div class="line">$self-&gt;safe_synchronize_AnalysisStats($stats);</div>
</div><!-- fragment --> <pre>  Description: Prewrapper around synchronize_AnalysisStats that does
               checks and grabs sync_lock before proceeding with sync.
               Used by distributed worker sync system to avoid contention.
  Exceptions : none
  Caller     : general</pre><pre> </pre><div id="codesection-safe_synchronize_AnalysisStats" class="dynheader closed" style="cursor:pointer;" onclick="return toggleVisibility(this)">  
    <img id='codesection-safe_synchronize_AnalysisStats-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-safe_synchronize_AnalysisStats-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-safe_synchronize_AnalysisStats-content' class='dyncontent' style='display: none;'> 
 <div class="fragment"><div class="line">sub <a class="code" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_queen.html#abe0354cbdbf898d95cf08cb2d167ba38">safe_synchronize_AnalysisStats</a> {</div>
<div class="line">    my ($self, $stats) = @_;</div>
<div class="line"></div>
<div class="line">    my $max_refresh_attempts = 5;</div>
<div class="line">    <span class="keywordflow">while</span>($stats-&gt;sync_lock and $max_refresh_attempts--) {   # another Worker/Beekeeper is synching <span class="keyword">this</span> analysis right now</div>
<div class="line">        sleep(1);</div>
<div class="line">        $stats-&gt;refresh();  # just <span class="keywordflow">try</span> to avoid collision</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> $stats <span class="keywordflow">if</span>($stats-&gt;status eq <span class="stringliteral">&#39;DONE&#39;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> $stats <span class="keywordflow">if</span>(($stats-&gt;status eq <span class="stringliteral">&#39;WORKING&#39;</span>) and</div>
<div class="line">                   ($stats-&gt;seconds_since_last_update &lt; 3*60));</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">        # try to claim the sync_lock</span></div>
<div class="line"><span class="preprocessor"></span>    my $sql = <span class="stringliteral">&quot;UPDATE analysis_stats SET status=&#39;SYNCHING&#39;, sync_lock=1 &quot;</span>.</div>
<div class="line">              <span class="stringliteral">&quot;WHERE sync_lock=0 and analysis_id=&quot;</span> . $stats-&gt;analysis_id;</div>
<div class="line">    my $row_count = $self-&gt;dbc-&gt;do($sql);  </div>
<div class="line">    <span class="keywordflow">return</span> $stats unless($row_count == 1);        # <span class="keywordflow">return</span> the un-updated status <span class="keywordflow">if</span> locked</div>
<div class="line">  </div>
<div class="line"><span class="preprocessor">        # if we managed to obtain the lock, let&#39;s go and perform the sync:</span></div>
<div class="line"><span class="preprocessor"></span>    $self-&gt;synchronize_AnalysisStats($stats);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> $stats;</div>
<div class="line">}</div>
</div><!-- fragment --> </div> 
</div>
</div>
<a class="anchor" id="adcc937a7a48d51f801d65757bc55bda2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public Bio::EnsEMBL::Hive::Queen::specialize_new_worker </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre>
  Description: If analysis_id or logic_name is specified it will try to specialize the <a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_worker.html">Worker</a> into this analysis.
               If not specified the <a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_queen.html">Queen</a> will analyze the hive and pick the most suitable analysis.
  Caller     : <a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_worker.html">Bio::EnsEMBL::Hive::Worker</a></pre><pre> </pre><div id="codesection-specialize_new_worker" class="dynheader closed" style="cursor:pointer;" onclick="return toggleVisibility(this)">  
    <img id='codesection-specialize_new_worker-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-specialize_new_worker-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-specialize_new_worker-content' class='dyncontent' style='display: none;'> 
 <div class="fragment"><div class="line">sub <a class="code" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_queen.html#adcc937a7a48d51f801d65757bc55bda2">specialize_new_worker</a> {</div>
<div class="line">    my ($self, $worker, @args) = @_;</div>
<div class="line"></div>
<div class="line">    my ($analysis_id, $logic_name, $job_id, $force) =</div>
<div class="line">        rearrange([qw(analysis_id logic_name job_id force) ], @args);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>( scalar( grep {defined($_)} ($analysis_id, $logic_name, $job_id) ) &gt; 1) {</div>
<div class="line">        die <span class="stringliteral">&quot;At most one of the options {-analysis_id, -logic_name, -job_id} can be set to pre-specialize a Worker&quot;</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    my ($analysis, $stats, $special_batch);</div>
<div class="line">    my $analysis_stats_adaptor = $self-&gt;db-&gt;get_AnalysisStatsAdaptor;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>($job_id or $analysis_id or $logic_name) {    # probably pre-specialized from command-line</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span>($job_id) {</div>
<div class="line">            print <span class="stringliteral">&quot;resetting and fetching job for job_id &#39;$job_id&#39;\n&quot;</span>;</div>
<div class="line"></div>
<div class="line">            my $job_adaptor = $self-&gt;db-&gt;get_AnalysisJobAdaptor;</div>
<div class="line"></div>
<div class="line">            my $job = $job_adaptor-&gt;fetch_by_dbID( $job_id )</div>
<div class="line">                or die <span class="stringliteral">&quot;Could not fetch job with dbID=&#39;$job_id&#39;&quot;</span>;</div>
<div class="line">            my $job_status = $job-&gt;status();</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span>($job_status =~/(CLAIMED|PRE_CLEANUP|FETCH_INPUT|RUN|WRITE_OUTPUT|POST_CLEANUP)/ ) {</div>
<div class="line">                die <span class="stringliteral">&quot;Job with dbID=&#39;$job_id&#39; is already in progress, cannot run&quot;</span>;   # FIXME: <span class="keywordflow">try</span> GC first, then complain</div>
<div class="line">            } elsif($job_status =~/(DONE|SEMAPHORED)/ and !$force) {</div>
<div class="line">                die <span class="stringliteral">&quot;Job with dbID=&#39;$job_id&#39; is $job_status, please use -force 1 to override&quot;</span>;</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span>(($job_status eq <span class="stringliteral">&#39;DONE&#39;</span>) and $job-&gt;semaphored_job_id) {</div>
<div class="line">                warn <span class="stringliteral">&quot;Increasing the semaphore count of the dependent job&quot;</span>;</div>
<div class="line">                $job_adaptor-&gt;increase_semaphore_count_for_jobid( $job-&gt;semaphored_job_id );</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            my $worker_id = $worker-&gt;dbID;</div>
<div class="line">            <span class="keywordflow">if</span>($job = $job_adaptor-&gt;reset_or_grab_job_by_dbID($job_id, $worker_id)) {</div>
<div class="line">                $special_batch = [ $job ];</div>
<div class="line">                $analysis_id = $job-&gt;analysis_id;</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                die <span class="stringliteral">&quot;Could not claim job with dbID=&#39;$job_id&#39; for worker with dbID=&#39;$worker_id&#39;&quot;</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span>($logic_name) {</div>
<div class="line">            $analysis = $self-&gt;db-&gt;get_AnalysisAdaptor-&gt;fetch_by_logic_name($logic_name)</div>
<div class="line">                or die <span class="stringliteral">&quot;analysis with name=&#39;$logic_name&#39; could not be fetched from the database&quot;</span>;</div>
<div class="line"></div>
<div class="line">            $analysis_id = $analysis-&gt;dbID;</div>
<div class="line"></div>
<div class="line">        } elsif($analysis_id) {</div>
<div class="line">            $analysis = $self-&gt;db-&gt;get_AnalysisAdaptor-&gt;fetch_by_dbID($analysis_id)</div>
<div class="line">                or die <span class="stringliteral">&quot;analysis with dbID=&#39;$analysis_id&#39; could not be fetched from the database&quot;</span>;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span>( $worker-&gt;resource_class_id</div>
<div class="line">        and $worker-&gt;resource_class_id != $analysis-&gt;resource_class_id) {</div>
<div class="line">                die <span class="stringliteral">&quot;resource_class of analysis &quot;</span>.$analysis-&gt;logic_name.<span class="stringliteral">&quot; is incompatible with this Worker&#39;s resource_class&quot;</span>;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        $stats = $analysis_stats_adaptor-&gt;fetch_by_analysis_id($analysis_id);</div>
<div class="line">        $self-&gt;safe_synchronize_AnalysisStats($stats);</div>
<div class="line"></div>
<div class="line">        unless($special_batch or $force) {    # <span class="keywordflow">do</span> we really need to run <span class="keyword">this</span> analysis?</div>
<div class="line">            <span class="keywordflow">if</span>($self-&gt;get_hive_current_load() &gt;= 1.1) {</div>
<div class="line">                $worker-&gt;cause_of_death(<span class="stringliteral">&#39;HIVE_OVERLOAD&#39;</span>);</div>
<div class="line">                die <span class="stringliteral">&quot;Hive is overloaded, can&#39;t specialize a worker&quot;</span>;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">if</span>($stats-&gt;status eq <span class="stringliteral">&#39;BLOCKED&#39;</span>) {</div>
<div class="line">                die <span class="stringliteral">&quot;Analysis is BLOCKED, can&#39;t specialize a worker&quot;</span>;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">if</span>($stats-&gt;num_required_workers &lt;= 0) {</div>
<div class="line">                die <span class="stringliteral">&quot;Analysis doesn&#39;t require extra workers at the moment&quot;</span>;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">if</span>($stats-&gt;status eq <span class="stringliteral">&#39;DONE&#39;</span>) {</div>
<div class="line">                die <span class="stringliteral">&quot;Analysis is DONE, and doesn&#39;t require workers&quot;</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"><span class="preprocessor">            # probably scheduled by beekeeper.pl:</span></div>
<div class="line"><span class="preprocessor"></span>    } elsif( $stats = <a class="code" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_scheduler.html#ab56e0d78a8774c93dc262a5c63812891">Bio::EnsEMBL::Hive::Scheduler::suggest_analysis_to_specialize_by_rc_id_meadow_type</a>($self, $worker-&gt;resource_class_id, $worker-&gt;meadow_type) ) {</div>
<div class="line"></div>
<div class="line">        $worker-&gt;analysis( undef ); # make sure we reset anything that was there before</div>
<div class="line">        $analysis_id = $stats-&gt;analysis_id;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        $worker-&gt;cause_of_death(<span class="stringliteral">&#39;NO_ROLE&#39;</span>);</div>
<div class="line">        die <span class="stringliteral">&quot;No analysis suitable for the worker was found\n&quot;</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">        # now set it in the $worker:</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">    $worker-&gt;analysis_id( $analysis_id );</div>
<div class="line"></div>
<div class="line">    $self-&gt;update_analysis_id( $worker );   # autoloaded</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>($special_batch) {</div>
<div class="line">        $worker-&gt;special_batch( $special_batch );</div>
<div class="line">    } <span class="keywordflow">else</span> {    # count it as autonomous worker sharing the load of that analysis:</div>
<div class="line"></div>
<div class="line">        $stats-&gt;update_status(<span class="stringliteral">&#39;WORKING&#39;</span>);</div>
<div class="line"></div>
<div class="line">        $analysis_stats_adaptor-&gt;decrease_required_workers($worker-&gt;analysis_id);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">        # The following increment used to be done only when no specific task was given to the worker,</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">        # thereby excluding such &quot;special task&quot; workers from being counted in num_running_workers.</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">        #</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">        # However this may be tricky to emulate by triggers that know nothing about &quot;special tasks&quot;,</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">        # so I am (temporarily?) simplifying the accounting algorithm.</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">        #</span></div>
<div class="line"><span class="preprocessor"></span>    unless( $self-&gt;db-&gt;hive_use_triggers() ) {</div>
<div class="line">        $analysis_stats_adaptor-&gt;increase_running_workers($worker-&gt;analysis_id);</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --> </div> 
</div>
</div>
<a class="anchor" id="a2f39e9a7a7eacf12c8c6262f32b7ffce"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public Newly Bio::EnsEMBL::Hive::Queen::synchronize_AnalysisStats </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre>
  Arg [1]    : <a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_analysis_stats.html">Bio::EnsEMBL::Hive::AnalysisStats</a> object
  Example    :</pre><div class="fragment"><div class="line">$self-&gt;synchronize($analysisStats);</div>
</div><!-- fragment --> <pre>  Description: Queries the job and worker tables to get summary counts
               and rebuilds the <a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_analysis_stats.html">AnalysisStats</a> object.  Then updates the
               analysis_stats table with the new summary info
  Returntype : newly synced <a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_analysis_stats.html">Bio::EnsEMBL::Hive::AnalysisStats</a> object
  Exceptions : none
  Caller     : general</pre><pre> </pre><div id="codesection-synchronize_AnalysisStats" class="dynheader closed" style="cursor:pointer;" onclick="return toggleVisibility(this)">  
    <img id='codesection-synchronize_AnalysisStats-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-synchronize_AnalysisStats-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-synchronize_AnalysisStats-content' class='dyncontent' style='display: none;'> 
 <div class="fragment"><div class="line">sub <a class="code" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_queen.html#a2f39e9a7a7eacf12c8c6262f32b7ffce">synchronize_AnalysisStats</a> {</div>
<div class="line">  my $self = shift;</div>
<div class="line">  my $analysisStats = shift;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span> $analysisStats unless($analysisStats);</div>
<div class="line">  <span class="keywordflow">return</span> $analysisStats unless($analysisStats-&gt;analysis_id);</div>
<div class="line"></div>
<div class="line">  $analysisStats-&gt;refresh(); ## Need to <span class="keyword">get</span> the <span class="keyword">new</span> hive_capacity <span class="keywordflow">for</span> dynamic analyses</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  unless($self-&gt;db-&gt;hive_use_triggers()) {</div>
<div class="line">      $analysisStats-&gt;total_job_count(0);</div>
<div class="line">      $analysisStats-&gt;semaphored_job_count(0);</div>
<div class="line">      $analysisStats-&gt;ready_job_count(0);</div>
<div class="line">      $analysisStats-&gt;done_job_count(0);</div>
<div class="line">      $analysisStats-&gt;failed_job_count(0);</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">            # ask for analysis_id to force MySQL to use existing index on (analysis_id, status)</span></div>
<div class="line"><span class="preprocessor"></span>      my $sql = <span class="stringliteral">&quot;SELECT analysis_id, status, count(*) FROM job WHERE analysis_id=? GROUP BY analysis_id, status&quot;</span>;</div>
<div class="line">      my $sth = $self-&gt;prepare($sql);</div>
<div class="line">      $sth-&gt;execute($analysisStats-&gt;analysis_id);</div>
<div class="line"></div>
<div class="line">      my $done_here       = 0;</div>
<div class="line">      my $done_elsewhere  = 0;</div>
<div class="line">      my $total_job_count = 0;</div>
<div class="line">      <span class="keywordflow">while</span> (my ($dummy_analysis_id, $status, $job_count)=$sth-&gt;fetchrow_array()) {</div>
<div class="line"><span class="preprocessor">    # print STDERR &quot;$status: $job_count\n&quot;;</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">        $total_job_count += $job_count;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span>($status eq <span class="stringliteral">&#39;READY&#39;</span>) {</div>
<div class="line">            $analysisStats-&gt;ready_job_count($job_count);</div>
<div class="line">        } elsif($status eq <span class="stringliteral">&#39;SEMAPHORED&#39;</span>) {</div>
<div class="line">            $analysisStats-&gt;semaphored_job_count($job_count);</div>
<div class="line">        } elsif($status eq <span class="stringliteral">&#39;DONE&#39;</span>) {</div>
<div class="line">            $done_here = $job_count;</div>
<div class="line">        } elsif($status eq <span class="stringliteral">&#39;PASSED_ON&#39;</span>) {</div>
<div class="line">            $done_elsewhere = $job_count;</div>
<div class="line">        } elsif ($status eq <span class="stringliteral">&#39;FAILED&#39;</span>) {</div>
<div class="line">            $analysisStats-&gt;failed_job_count($job_count);</div>
<div class="line">        }</div>
<div class="line">      } # /<span class="keywordflow">while</span></div>
<div class="line">      $sth-&gt;finish;</div>
<div class="line"></div>
<div class="line">      $analysisStats-&gt;total_job_count( $total_job_count );</div>
<div class="line">      $analysisStats-&gt;done_job_count( $done_here + $done_elsewhere );</div>
<div class="line">  } # unless($self-&gt;db-&gt;hive_use_triggers())</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">        # compute the number of total required workers <span class="keywordflow">for</span> <span class="keyword">this</span> analysis (taking into account the jobs that are already running)</div>
<div class="line">    my $analysis              = $analysisStats-&gt;get_analysis();</div>
<div class="line">    my $scheduling_allowed    =  ( !defined( $analysisStats-&gt;hive_capacity ) or $analysisStats-&gt;hive_capacity )</div>
<div class="line">                              &amp;&amp; ( !defined( $analysis-&gt;analysis_capacity  ) or $analysis-&gt;analysis_capacity  );</div>
<div class="line">    my $required_workers    = $scheduling_allowed</div>
<div class="line">                            &amp;&amp; POSIX::ceil( $analysisStats-&gt;ready_job_count() / $analysisStats-&gt;get_or_estimate_batch_size() );</div>
<div class="line">    $analysisStats-&gt;num_required_workers( $required_workers );</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    $analysisStats-&gt;check_blocking_control_rules();</div>
<div class="line"></div>
<div class="line">    if($analysisStats-&gt;status ne &#39;BLOCKED&#39;) {</div>
<div class="line">        $analysisStats-&gt;determine_status();</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">    # $analysisStats-&gt;sync_lock(0); ## do we perhaps need it here?</span></div>
<div class="line"><span class="preprocessor"></span>    $analysisStats-&gt;update;  #<a class="code" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_base_adaptor.html#ab8f4cc3813b7d1ad259b02e4a24112f2">update</a> and release sync_lock</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> $analysisStats;</div>
<div class="line">}</div>
</div><!-- fragment --> </div> 
</div>
</div>
<a class="anchor" id="a2892c256744ac4bdd4f90b9bcc238735"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public Bio::EnsEMBL::Hive::Queen::synchronize_hive </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre>
  Arg [1]    : $filter_analysis (optional)
  Example    :</pre><div class="fragment"><div class="line">$queen-&gt;synchronize_hive();</div>
</div><!-- fragment --> <pre>  Description: Runs through all analyses in the system and synchronizes
              the analysis_stats summary with the states in the job 
              and worker tables.  Then follows by checking all the blocking rules
              and blocks/unblocks analyses as needed.
  Exceptions : none
  Caller     : general</pre><pre> </pre><div id="codesection-synchronize_hive" class="dynheader closed" style="cursor:pointer;" onclick="return toggleVisibility(this)">  
    <img id='codesection-synchronize_hive-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-synchronize_hive-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-synchronize_hive-content' class='dyncontent' style='display: none;'> 
 <div class="fragment"><div class="line">sub <a class="code" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_queen.html#a2892c256744ac4bdd4f90b9bcc238735">synchronize_hive</a> {</div>
<div class="line">  my $self          = shift;</div>
<div class="line">  my $filter_analysis = shift; # optional parameter</div>
<div class="line"></div>
<div class="line">  my $start_time = time();</div>
<div class="line"></div>
<div class="line">  my $list_of_analyses = $filter_analysis ? [$filter_analysis] : $self-&gt;db-&gt;get_AnalysisAdaptor-&gt;fetch_all;</div>
<div class="line"></div>
<div class="line">  print STDERR <span class="stringliteral">&quot;\nSynchronizing the hive (&quot;</span>.scalar(@$list_of_analyses).<span class="stringliteral">&quot; analyses this time):\n&quot;</span>;</div>
<div class="line">  <span class="keywordflow">foreach</span> my $analysis (@$list_of_analyses) {</div>
<div class="line">    $self-&gt;synchronize_AnalysisStats($analysis-&gt;stats);</div>
<div class="line">    print STDERR ( ($analysis-&gt;stats()-&gt;status eq <span class="stringliteral">&#39;BLOCKED&#39;</span>) ? <span class="charliteral">&#39;x&#39;</span> : <span class="charliteral">&#39;o&#39;</span>);</div>
<div class="line">  }</div>
<div class="line">  print STDERR <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"></div>
<div class="line">  print STDERR <span class="stringliteral">&#39;&#39;</span>.((time() - $start_time)).<span class="stringliteral">&quot; seconds to synchronize_hive\n\n&quot;</span>;</div>
<div class="line">}</div>
</div><!-- fragment --> </div> 
</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>modules/Bio/EnsEMBL/Hive/<a class="el" href="_queen_8pm.html">Queen.pm</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespace_bio.html">Bio</a></li><li class="navelem"><a class="el" href="namespace_bio_1_1_ens_e_m_b_l.html">EnsEMBL</a></li><li class="navelem"><a class="el" href="namespace_bio_1_1_ens_e_m_b_l_1_1_hive.html">Hive</a></li><li class="navelem"><a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_queen.html">Queen</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
