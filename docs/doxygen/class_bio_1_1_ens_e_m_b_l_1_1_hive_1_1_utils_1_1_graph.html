<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>ensembl-hive: Bio::EnsEMBL::Hive::Utils::Graph Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">ensembl-hive
   &#160;<span id="projectnumber">2.3</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="inherits.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_utils_1_1_graph.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_utils_1_1_graph-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">Bio::EnsEMBL::Hive::Utils::Graph Class Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png" alt="+"/> Inheritance diagram for Bio::EnsEMBL::Hive::Utils::Graph:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><img src="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_utils_1_1_graph__inherit__graph.png" border="0" usemap="#_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_utils_1_1_graph_inherit__map" alt="Inheritance graph"/></div>
<map name="_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_utils_1_1_graph_inherit__map" id="_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_utils_1_1_graph_inherit__map">
<area shape="rect" id="node2" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_configurable.html" title="Bio::EnsEMBL::Hive\l::Configurable" alt="" coords="5,6,147,47"/></map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<div id="dynsection-1" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-1-trigger" src="closed.png" alt="+"/> Collaboration diagram for Bio::EnsEMBL::Hive::Utils::Graph:</div>
<div id="dynsection-1-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-1-content" class="dyncontent" style="display:none;">
<div class="center"><img src="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_utils_1_1_graph__coll__graph.png" border="0" usemap="#_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_utils_1_1_graph_coll__map" alt="Collaboration graph"/></div>
<map name="_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_utils_1_1_graph_coll__map" id="_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_utils_1_1_graph_coll__map">
<area shape="rect" id="node2" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_configurable.html" title="Bio::EnsEMBL::Hive\l::Configurable" alt="" coords="5,6,147,47"/></map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a0452e8098246f27173059b14600f190c"><td class="memItemLeft" align="right" valign="top">public <a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_utils_1_1_graph.html">Graph</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_utils_1_1_graph.html#a0452e8098246f27173059b14600f190c">new</a> ()</td></tr>
<tr class="separator:a0452e8098246f27173059b14600f190c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5f9efde876681aea12fc343faae97dab"><td class="memItemLeft" align="right" valign="top">public <a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_utils_1_1_graph_viz.html">GraphViz</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_utils_1_1_graph.html#a5f9efde876681aea12fc343faae97dab">graph</a> ()</td></tr>
<tr class="separator:a5f9efde876681aea12fc343faae97dab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac8693dd43801529d292bcad623b6360c"><td class="memItemLeft" align="right" valign="top">public DBAdaptor&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_utils_1_1_graph.html#ac8693dd43801529d292bcad623b6360c">hive_dba</a> ()</td></tr>
<tr class="separator:ac8693dd43801529d292bcad623b6360c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab6415312e311c5a6fe8d7aa89ba3684a"><td class="memItemLeft" align="right" valign="top">protected&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_utils_1_1_graph.html#ab6415312e311c5a6fe8d7aa89ba3684a">_analysis_node_name</a> ()</td></tr>
<tr class="separator:ab6415312e311c5a6fe8d7aa89ba3684a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af860b66fd159323a7c507fa27b2f3794"><td class="memItemLeft" align="right" valign="top">protected&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_utils_1_1_graph.html#af860b66fd159323a7c507fa27b2f3794">_table_node_name</a> ()</td></tr>
<tr class="separator:af860b66fd159323a7c507fa27b2f3794"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a546d1e3d214a8c2ba2c25a8d94ac0813"><td class="memItemLeft" align="right" valign="top">protected&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_utils_1_1_graph.html#a546d1e3d214a8c2ba2c25a8d94ac0813">_midpoint_name</a> ()</td></tr>
<tr class="separator:a546d1e3d214a8c2ba2c25a8d94ac0813"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad7fad3a0d313ae9d07c6b6e636876109"><td class="memItemLeft" align="right" valign="top">public The&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_utils_1_1_graph.html#ad7fad3a0d313ae9d07c6b6e636876109">build</a> ()</td></tr>
<tr class="separator:ad7fad3a0d313ae9d07c6b6e636876109"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aefb7c89ca1e64a84a64329aa7277e612"><td class="memItemLeft" align="right" valign="top">protected&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_utils_1_1_graph.html#aefb7c89ca1e64a84a64329aa7277e612">_propagate_allocation</a> ()</td></tr>
<tr class="separator:aefb7c89ca1e64a84a64329aa7277e612"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7f66903e2bbdee1dc8facbb2274ac6b9"><td class="memItemLeft" align="right" valign="top">protected&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_utils_1_1_graph.html#a7f66903e2bbdee1dc8facbb2274ac6b9">_add_pipeline_label</a> ()</td></tr>
<tr class="separator:a7f66903e2bbdee1dc8facbb2274ac6b9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a15c083cbf55912f540a1a62c63f36ccd"><td class="memItemLeft" align="right" valign="top">protected&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_utils_1_1_graph.html#a15c083cbf55912f540a1a62c63f36ccd">_add_analysis_node</a> ()</td></tr>
<tr class="separator:a15c083cbf55912f540a1a62c63f36ccd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a43e296bc05745d61f990d50fb962d7fc"><td class="memItemLeft" align="right" valign="top">protected&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_utils_1_1_graph.html#a43e296bc05745d61f990d50fb962d7fc">_add_control_rules</a> ()</td></tr>
<tr class="separator:a43e296bc05745d61f990d50fb962d7fc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3b32094dcff97c58cc418c436a01e9da"><td class="memItemLeft" align="right" valign="top">protected&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_utils_1_1_graph.html#a3b32094dcff97c58cc418c436a01e9da">_add_dataflow_rules</a> ()</td></tr>
<tr class="separator:a3b32094dcff97c58cc418c436a01e9da"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5f15e355d2750a68a1a219ef2decc55a"><td class="memItemLeft" align="right" valign="top">protected&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_utils_1_1_graph.html#a5f15e355d2750a68a1a219ef2decc55a">_add_table_node</a> ()</td></tr>
<tr class="separator:a5f15e355d2750a68a1a219ef2decc55a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pub_methods_class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_configurable"><td colspan="2" onclick="javascript:toggleInherit('pub_methods_class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_configurable')"><img src="closed.png" alt="-"/>&#160;Public Member Functions inherited from <a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_configurable.html">Bio::EnsEMBL::Hive::Configurable</a></td></tr>
<tr class="memitem:a38c57142acfd31f32e87a94717620baf inherit pub_methods_class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_configurable"><td class="memItemLeft" align="right" valign="top">public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_configurable.html#a38c57142acfd31f32e87a94717620baf">config</a> ()</td></tr>
<tr class="separator:a38c57142acfd31f32e87a94717620baf inherit pub_methods_class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_configurable"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a419025891535ecd7b2f05183cf2ce8e4 inherit pub_methods_class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_configurable"><td class="memItemLeft" align="right" valign="top">public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_configurable.html#a419025891535ecd7b2f05183cf2ce8e4">context</a> ()</td></tr>
<tr class="separator:a419025891535ecd7b2f05183cf2ce8e4 inherit pub_methods_class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_configurable"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeed405377caddb6a1aa3cb605ed6304f inherit pub_methods_class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_configurable"><td class="memItemLeft" align="right" valign="top">public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_configurable.html#aeed405377caddb6a1aa3cb605ed6304f">config_get</a> ()</td></tr>
<tr class="separator:aeed405377caddb6a1aa3cb605ed6304f inherit pub_methods_class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_configurable"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3e556c76396430193c3f613c6f3e4079 inherit pub_methods_class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_configurable"><td class="memItemLeft" align="right" valign="top">public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_configurable.html#a3e556c76396430193c3f613c6f3e4079">config_set</a> ()</td></tr>
<tr class="separator:a3e556c76396430193c3f613c6f3e4079 inherit pub_methods_class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_configurable"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><h1><a class="anchor" id="Synopsis"></a>
Synopsis</h1>
<div class="fragment"><div class="line">my $hive_dba = get_hive_dba();</div>
<div class="line">my $g = <a class="code" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_utils_1_1_graph.html">Bio::EnsEMBL::Hive::Utils::Graph</a>-&gt;<a class="code" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_utils_1_1_graph.html#a0452e8098246f27173059b14600f190c">new</a>(-DBA =&gt; $hive_dba);</div>
<div class="line">my $graphviz = $g-&gt;<a class="code" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_utils_1_1_graph.html#ad7fad3a0d313ae9d07c6b6e636876109">build</a>();</div>
<div class="line">$graphviz-&gt;as_png(<span class="stringliteral">&#39;location.png&#39;</span>);</div>
</div><!-- fragment --> <h1><a class="anchor" id="Description"></a>
Description</h1>
 <pre>
    This is a module for converting a hive database's flow of analyses, control 
    rules and dataflows into the GraphViz model language. This information can
    then be converted to an image or to the dot language for further manipulation
    in GraphViz.

</pre> </div><h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="a15c083cbf55912f540a1a62c63f36ccd"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">protected Bio::EnsEMBL::Hive::Utils::Graph::_add_analysis_node </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Undocumented method</p>
<div id="codesection-_add_analysis_node" class="dynheader closed" style="cursor:pointer;" onclick="return toggleVisibility(this)">  
    <img id='codesection-_add_analysis_node-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-_add_analysis_node-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-_add_analysis_node-content' class='dyncontent' style='display: none;'> 
 <div class="fragment"><div class="line">sub <a class="code" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_utils_1_1_graph.html#a15c083cbf55912f540a1a62c63f36ccd">_add_analysis_node</a> {</div>
<div class="line">    my ($self, $analysis) = @_;</div>
<div class="line"></div>
<div class="line">    my $analysis_stats = $analysis-&gt;stats();</div>
<div class="line"></div>
<div class="line">    my ($breakout_label, $total_job_count, $count_hash)   = $analysis_stats-&gt;job_count_breakout();</div>
<div class="line">    my $analysis_status                                   = $analysis_stats-&gt;status;</div>
<div class="line">    my $analysis_status_colour                            = $self-&gt;config_get(<span class="stringliteral">&#39;Node&#39;</span>, <span class="stringliteral">&#39;AnalysisStatus&#39;</span>, $analysis_status, <span class="stringliteral">&#39;Colour&#39;</span>);</div>
<div class="line">    my $style                                             = $analysis-&gt;can_be_empty() ? <span class="stringliteral">&#39;dashed, filled&#39;</span> : <span class="stringliteral">&#39;filled&#39;</span> ;</div>
<div class="line">    my $node_fontname                                     = $self-&gt;config_get(<span class="stringliteral">&#39;Node&#39;</span>, <span class="stringliteral">&#39;AnalysisStatus&#39;</span>, $analysis_status, <span class="stringliteral">&#39;Font&#39;</span>);</div>
<div class="line">    my $display_stats                                     = $self-&gt;config_get(<span class="stringliteral">&#39;DisplayStats&#39;</span>);</div>
<div class="line">    my $hive_dba                                          = $self-&gt;hive_dba;</div>
<div class="line"></div>
<div class="line">    my $colspan = 0;</div>
<div class="line">    my $bar_chart = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>( $display_stats eq <span class="stringliteral">&#39;barchart&#39;</span> ) {</div>
<div class="line">        <span class="keywordflow">foreach</span> my $count_method (qw(SEMAPHORED READY INPROGRESS DONE FAILED)) {</div>
<div class="line">            <span class="keywordflow">if</span>(my $count=$count_hash-&gt;{lc($count_method).<span class="stringliteral">&#39;_job_count&#39;</span>}) {</div>
<div class="line">                $bar_chart .= <span class="stringliteral">&#39;&lt;td bgcolor=&quot;&#39;</span>.$self-&gt;config_get(<span class="stringliteral">&#39;Node&#39;</span>, <span class="stringliteral">&#39;JobStatus&#39;</span>, $count_method, <span class="stringliteral">&#39;Colour&#39;</span>).<span class="stringliteral">&#39;&quot; width=&quot;&#39;</span>.int(100*$count/$total_job_count).<span class="stringliteral">&#39;%&quot;&gt;&#39;</span>.$count.lc(substr($count_method,0,1)).<span class="stringliteral">&#39;&lt;/td&gt;&#39;</span>;</div>
<div class="line">                ++$colspan;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span>($colspan != 1) {</div>
<div class="line">            $bar_chart .= <span class="stringliteral">&#39;&lt;td&gt;=&#39;</span>.$total_job_count.<span class="stringliteral">&#39;&lt;/td&gt;&#39;</span>;</div>
<div class="line">            ++$colspan;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    $colspan ||= 1;</div>
<div class="line">    my $analysis_label  = <span class="stringliteral">&#39;&lt;&lt;table border=&quot;0&quot; cellborder=&quot;0&quot; cellspacing=&quot;0&quot; cellpadding=&quot;1&quot;&gt;&lt;tr&gt;&lt;td colspan=&quot;&#39;</span>.$colspan.<span class="stringliteral">&#39;&quot;&gt;&#39;</span>.$analysis-&gt;display_name( $hive_dba ).<span class="stringliteral">&#39; (&#39;</span>.($analysis-&gt;dbID || <span class="charliteral">&#39;?&#39;</span>).<span class="stringliteral">&#39;)&lt;/td&gt;&lt;/tr&gt;&#39;</span>;</div>
<div class="line">    <span class="keywordflow">if</span>( $display_stats ) {</div>
<div class="line">        $analysis_label    .= qq{&lt;tr&gt;&lt;td colspan=<span class="stringliteral">&quot;$colspan&quot;</span>&gt; &lt;/td&gt;&lt;/tr&gt;};</div>
<div class="line">        <span class="keywordflow">if</span>( $display_stats eq <span class="stringliteral">&#39;barchart&#39;</span>) {</div>
<div class="line">            $analysis_label    .= qq{&lt;tr&gt;$bar_chart&lt;/tr&gt;};</div>
<div class="line">        } elsif( $display_stats eq <span class="stringliteral">&#39;text&#39;</span>) {</div>
<div class="line">            $analysis_label    .= qq{&lt;tr&gt;&lt;td colspan=<span class="stringliteral">&quot;$colspan&quot;</span>&gt;$breakout_label&lt;/td&gt;&lt;/tr&gt;};</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>( my $job_limit = $self-&gt;config_get(<span class="stringliteral">&#39;DisplayJobs&#39;</span>) ) {</div>
<div class="line">        my @jobs = @{ $analysis-&gt;jobs_collection };</div>
<div class="line"></div>
<div class="line">        my $hit_limit;</div>
<div class="line">        <span class="keywordflow">if</span>(scalar(@jobs)&gt;$job_limit) {</div>
<div class="line">            pop @jobs;</div>
<div class="line">            $hit_limit = 1;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        $analysis_label    .= <span class="stringliteral">&#39;&lt;tr&gt;&lt;td colspan=&quot;&#39;</span>.$colspan.<span class="stringliteral">&#39;&quot;&gt; &lt;/td&gt;&lt;/tr&gt;&#39;</span>;</div>
<div class="line">        <span class="keywordflow">foreach</span> my $job (@jobs) {</div>
<div class="line">            my $input_id = $job-&gt;input_id;</div>
<div class="line">            my $status   = $job-&gt;status;</div>
<div class="line">            my $job_id   = $job-&gt;dbID;</div>
<div class="line">            $input_id=~s/\&gt;/&amp;gt;/g;</div>
<div class="line">            $input_id=~s/\&lt;/&amp;lt;/g;</div>
<div class="line">            $input_id=~s/\{|\}<span class="comment">//g;</span></div>
<div class="line">            $analysis_label    .= qq{&lt;tr&gt;&lt;td colspan=<span class="stringliteral">&quot;$colspan&quot;</span> bgcolor=<span class="stringliteral">&quot;}.$self-&gt;config_get(&#39;Node&#39;, &#39;JobStatus&#39;, $status, &#39;Colour&#39;).qq{&quot;</span>&gt;$job_id [$status]: $input_id&lt;/td&gt;&lt;/tr&gt;};</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span>($hit_limit) {</div>
<div class="line">            $analysis_label    .= qq{&lt;tr&gt;&lt;td colspan=<span class="stringliteral">&quot;$colspan&quot;</span>&gt;[ and }.($total_job_count-$job_limit).qq{ more ]&lt;/td&gt;&lt;/tr&gt;};</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    $analysis_label    .= <span class="stringliteral">&#39;&lt;/table&gt;&gt;&#39;</span>;</div>
<div class="line">  </div>
<div class="line">    $self-&gt;graph-&gt;add_node( $self-&gt;_analysis_node_name( $analysis ),</div>
<div class="line">        label       =&gt; $analysis_label,</div>
<div class="line">        shape       =&gt; <span class="stringliteral">&#39;record&#39;</span>,</div>
<div class="line">        fontname    =&gt; $node_fontname,</div>
<div class="line">        style       =&gt; $style,</div>
<div class="line">        fillcolor   =&gt; $analysis_status_colour,</div>
<div class="line">    );</div>
<div class="line">}</div>
</div><!-- fragment --> </div> 
</div>
</div>
<a class="anchor" id="a43e296bc05745d61f990d50fb962d7fc"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">protected Bio::EnsEMBL::Hive::Utils::Graph::_add_control_rules </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Undocumented method</p>
<div id="codesection-_add_control_rules" class="dynheader closed" style="cursor:pointer;" onclick="return toggleVisibility(this)">  
    <img id='codesection-_add_control_rules-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-_add_control_rules-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-_add_control_rules-content' class='dyncontent' style='display: none;'> 
 <div class="fragment"><div class="line">sub <a class="code" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_utils_1_1_graph.html#a43e296bc05745d61f990d50fb962d7fc">_add_control_rules</a> {</div>
<div class="line">  my ($self, $ctrl_rules) = @_;</div>
<div class="line">  </div>
<div class="line">  my $control_colour = $self-&gt;config_get(<span class="stringliteral">&#39;Edge&#39;</span>, <span class="stringliteral">&#39;Control&#39;</span>, <span class="stringliteral">&#39;Colour&#39;</span>);</div>
<div class="line">  my $graph = $self-&gt;graph();</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">      #The control rules are always from and to an analysis so no need to search for odd cases here</span></div>
<div class="line"><span class="preprocessor"></span>  <span class="keywordflow">foreach</span> my $c_rule ( @$ctrl_rules ) {</div>
<div class="line">    my $from_node_name = $self-&gt;_analysis_node_name( $c_rule-&gt;condition_analysis );</div>
<div class="line">    my $to_node_name   = $self-&gt;_analysis_node_name( $c_rule-&gt;ctrled_analysis );</div>
<div class="line"></div>
<div class="line">    $graph-&gt;add_edge( $from_node_name =&gt; $to_node_name,</div>
<div class="line">      color =&gt; $control_colour,</div>
<div class="line">      arrowhead =&gt; <span class="stringliteral">&#39;tee&#39;</span>,</div>
<div class="line">    );</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --> </div> 
</div>
</div>
<a class="anchor" id="a3b32094dcff97c58cc418c436a01e9da"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">protected Bio::EnsEMBL::Hive::Utils::Graph::_add_dataflow_rules </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Undocumented method</p>
<div id="codesection-_add_dataflow_rules" class="dynheader closed" style="cursor:pointer;" onclick="return toggleVisibility(this)">  
    <img id='codesection-_add_dataflow_rules-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-_add_dataflow_rules-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-_add_dataflow_rules-content' class='dyncontent' style='display: none;'> 
 <div class="fragment"><div class="line">sub <a class="code" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_utils_1_1_graph.html#a3b32094dcff97c58cc418c436a01e9da">_add_dataflow_rules</a> {</div>
<div class="line">    my ($self, $dataflow_rules) = @_;</div>
<div class="line"></div>
<div class="line">    my $graph = $self-&gt;graph();</div>
<div class="line">    my $dataflow_colour     = $self-&gt;config_get(<span class="stringliteral">&#39;Edge&#39;</span>, <span class="stringliteral">&#39;Data&#39;</span>, <span class="stringliteral">&#39;Colour&#39;</span>);</div>
<div class="line">    my $semablock_colour    = $self-&gt;config_get(<span class="stringliteral">&#39;Edge&#39;</span>, <span class="stringliteral">&#39;Semablock&#39;</span>, <span class="stringliteral">&#39;Colour&#39;</span>);</div>
<div class="line">    my $accu_colour         = $self-&gt;config_get(<span class="stringliteral">&#39;Edge&#39;</span>, <span class="stringliteral">&#39;Accu&#39;</span>, <span class="stringliteral">&#39;Colour&#39;</span>);</div>
<div class="line">    my $df_edge_fontname    = $self-&gt;config_get(<span class="stringliteral">&#39;Edge&#39;</span>, <span class="stringliteral">&#39;Data&#39;</span>, <span class="stringliteral">&#39;Font&#39;</span>);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">foreach</span> my $df_rule ( @$dataflow_rules ) {</div>
<div class="line">    </div>
<div class="line">        my ($from_analysis, $branch_code, $funnel_dataflow_rule) =</div>
<div class="line">            ($df_rule-&gt;from_analysis, $df_rule-&gt;branch_code, $df_rule-&gt;funnel_dataflow_rule);</div>
<div class="line"></div>
<div class="line">        my $input_id_template = $self-&gt;config_get(<span class="stringliteral">&#39;DisplayInputIDTemplate&#39;</span>) ? $df_rule-&gt;input_id_template : undef;</div>
<div class="line">        $input_id_template = join(<span class="stringliteral">&quot;,\n&quot;</span>, sort keys( %{<a class="code" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_utils.html#ac3350cd70c4187290ded88a59533e62d">destringify</a>($input_id_template)} )) if $input_id_template;</div>
<div class="line"></div>
<div class="line">        my $target_object       = $df_rule-&gt;to_analysis</div>
<div class="line">            or die &quot;Could not fetch a target <span class="keywordtype">object</span> for url=&#39;&quot;.$df_rule-&gt;to_analysis_url.&quot;&#39;, please check your database for consistency.\n&quot;;</div>
<div class="line"></div>
<div class="line">        my $from_node_name = $self-&gt;<a class="code" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_utils_1_1_graph.html#ab6415312e311c5a6fe8d7aa89ba3684a">_analysis_node_name</a>( $from_analysis );</div>
<div class="line">        my $target_node_name;</div>
<div class="line">    </div>
<div class="line">            <span class="preprocessor"># Different treatment for analyses and tables:</span></div>
<div class="line"><span class="preprocessor"></span>        <span class="keywordflow">if</span>(UNIVERSAL::isa($target_object, <span class="stringliteral">&#39;Bio::EnsEMBL::Hive::Analysis&#39;</span>)) {</div>
<div class="line"></div>
<div class="line">            $target_node_name = $self-&gt;_analysis_node_name( $target_object );</div>
<div class="line"></div>
<div class="line">        } elsif(UNIVERSAL::isa($target_object, <span class="stringliteral">&#39;Bio::EnsEMBL::Hive::NakedTable&#39;</span>)) {</div>
<div class="line"></div>
<div class="line">            $target_node_name = $self-&gt;_table_node_name( $df_rule );</div>
<div class="line">            $self-&gt;_add_table_node($target_node_name, $target_object);</div>
<div class="line"></div>
<div class="line">        } elsif(UNIVERSAL::isa($target_object, <span class="stringliteral">&#39;Bio::EnsEMBL::Hive::Accumulator&#39;</span>)) {</div>
<div class="line"></div>
<div class="line">            $target_node_name = <a class="code" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_utils_1_1_graph.html#a546d1e3d214a8c2ba2c25a8d94ac0813">_midpoint_name</a>( $from_analysis-&gt;{<span class="stringliteral">&#39;_funnel_dfr&#39;</span>} );</div>
<div class="line"></div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            warn(<span class="stringliteral">&quot;Do not know how to handle the type &#39;&quot;</span>.ref($target_object).<span class="stringliteral">&quot;&#39;&quot;</span>);</div>
<div class="line">            next;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">            # a rule needs a midpoint either if it HAS a funnel or if it IS a funnel</span></div>
<div class="line"><span class="preprocessor"></span>        <span class="keywordflow">if</span>( $funnel_dataflow_rule or $df_rule-&gt;{<span class="stringliteral">&#39;_is_a_funnel&#39;</span>} ) {</div>
<div class="line">            my $midpoint_name = <a class="code" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_utils_1_1_graph.html#a546d1e3d214a8c2ba2c25a8d94ac0813">_midpoint_name</a>( $df_rule );</div>
<div class="line"></div>
<div class="line">            $graph-&gt;add_node( $midpoint_name,   # midpoint itself</div>
<div class="line">                color       =&gt; $dataflow_colour,</div>
<div class="line">                label       =&gt; <span class="stringliteral">&#39;&#39;</span>,</div>
<div class="line">                shape       =&gt; <span class="stringliteral">&#39;point&#39;</span>,</div>
<div class="line">                fixedsize   =&gt; 1,</div>
<div class="line">                width       =&gt; 0.01,</div>
<div class="line">                height      =&gt; 0.01,</div>
<div class="line">            );</div>
<div class="line">            $graph-&gt;add_edge( $from_node_name =&gt; $midpoint_name, # first half of the two-part arrow</div>
<div class="line">                color       =&gt; $dataflow_colour,</div>
<div class="line">                arrowhead   =&gt; <span class="stringliteral">&#39;none&#39;</span>,</div>
<div class="line">                fontname    =&gt; $df_edge_fontname,</div>
<div class="line">                fontcolor   =&gt; $dataflow_colour,</div>
<div class="line">                label       =&gt; <span class="charliteral">&#39;#&#39;</span>.$branch_code.($input_id_template ? <span class="stringliteral">&quot;:\n&quot;</span>.$input_id_template : <span class="stringliteral">&#39;&#39;</span>),</div>
<div class="line">            );</div>
<div class="line">            $graph-&gt;add_edge( $midpoint_name =&gt; $target_node_name,   # second half of the two-part arrow</div>
<div class="line">                color     =&gt; $dataflow_colour,</div>
<div class="line">            );</div>
<div class="line">            <span class="keywordflow">if</span>($funnel_dataflow_rule) {</div>
<div class="line">                $graph-&gt;add_edge( $midpoint_name =&gt; <a class="code" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_utils_1_1_graph.html#a546d1e3d214a8c2ba2c25a8d94ac0813">_midpoint_name</a>( $funnel_dataflow_rule ),   # semaphore inter-rule link</div>
<div class="line">                    color     =&gt; $semablock_colour,</div>
<div class="line">                    style     =&gt; <span class="stringliteral">&#39;dashed&#39;</span>,</div>
<div class="line">                    arrowhead =&gt; <span class="stringliteral">&#39;tee&#39;</span>,</div>
<div class="line">                    dir       =&gt; <span class="stringliteral">&#39;both&#39;</span>,</div>
<div class="line">                    arrowtail =&gt; <span class="stringliteral">&#39;crow&#39;</span>,</div>
<div class="line">                );</div>
<div class="line">            }</div>
<div class="line">        } elsif(UNIVERSAL::isa($target_object, <span class="stringliteral">&#39;Bio::EnsEMBL::Hive::Accumulator&#39;</span>)) {</div>
<div class="line"><span class="preprocessor">                # one-part dashed arrow:</span></div>
<div class="line"><span class="preprocessor"></span>            $graph-&gt;add_edge( $from_node_name =&gt; $target_node_name,</div>
<div class="line">                color       =&gt; $accu_colour,</div>
<div class="line">                style       =&gt; <span class="stringliteral">&#39;dashed&#39;</span>,</div>
<div class="line">                label       =&gt; <span class="charliteral">&#39;#&#39;</span>.$branch_code.<span class="stringliteral">&quot;:\n&quot;</span>.$target_object-&gt;display_name( $self-&gt;hive_dba ),</div>
<div class="line">                fontname    =&gt; $df_edge_fontname,</div>
<div class="line">                fontcolor   =&gt; $accu_colour,</div>
<div class="line">                dir         =&gt; <span class="stringliteral">&#39;both&#39;</span>,</div>
<div class="line">                arrowtail   =&gt; <span class="stringliteral">&#39;crow&#39;</span>,</div>
<div class="line">            );</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="preprocessor">                # one-part solid arrow:</span></div>
<div class="line"><span class="preprocessor"></span>            $graph-&gt;add_edge( $from_node_name =&gt; $target_node_name,</div>
<div class="line">                color       =&gt; $dataflow_colour,</div>
<div class="line">                fontname    =&gt; $df_edge_fontname,</div>
<div class="line">                fontcolor   =&gt; $dataflow_colour,</div>
<div class="line">                label       =&gt; <span class="charliteral">&#39;#&#39;</span>.$branch_code.($input_id_template ? <span class="stringliteral">&quot;:\n&quot;</span>.$input_id_template : <span class="stringliteral">&#39;&#39;</span>),</div>
<div class="line">            );</div>
<div class="line">        } # /<span class="keywordflow">if</span>( <span class="stringliteral">&quot;$df_rule needs a midpoint&quot;</span> )</div>
<div class="line">    } # /<span class="keywordflow">foreach</span> my $df_rule (@$dataflow_rules)</div>
<div class="line"></div>
<div class="line">}</div>
</div><!-- fragment --> </div> 
</div>
</div>
<a class="anchor" id="a7f66903e2bbdee1dc8facbb2274ac6b9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">protected Bio::EnsEMBL::Hive::Utils::Graph::_add_pipeline_label </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Undocumented method</p>
<div id="codesection-_add_pipeline_label" class="dynheader closed" style="cursor:pointer;" onclick="return toggleVisibility(this)">  
    <img id='codesection-_add_pipeline_label-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-_add_pipeline_label-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-_add_pipeline_label-content' class='dyncontent' style='display: none;'> 
 <div class="fragment"><div class="line">sub <a class="code" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_utils_1_1_graph.html#a7f66903e2bbdee1dc8facbb2274ac6b9">_add_pipeline_label</a> {</div>
<div class="line">    my ($self, $pipeline_label) = @_;</div>
<div class="line"></div>
<div class="line">    my $node_fontname  = $self-&gt;config_get(<span class="stringliteral">&#39;Node&#39;</span>, <span class="stringliteral">&#39;Details&#39;</span>, <span class="stringliteral">&#39;Font&#39;</span>);</div>
<div class="line">    $self-&gt;graph()-&gt;add_node( <span class="stringliteral">&#39;Details&#39;</span>,</div>
<div class="line">        label     =&gt; $pipeline_label,</div>
<div class="line">        fontname  =&gt; $node_fontname,</div>
<div class="line">        shape     =&gt; <span class="stringliteral">&#39;plaintext&#39;</span>,</div>
<div class="line">    );</div>
<div class="line">}</div>
</div><!-- fragment --> </div> 
</div>
</div>
<a class="anchor" id="a5f15e355d2750a68a1a219ef2decc55a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">protected Bio::EnsEMBL::Hive::Utils::Graph::_add_table_node </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Undocumented method</p>
<div id="codesection-_add_table_node" class="dynheader closed" style="cursor:pointer;" onclick="return toggleVisibility(this)">  
    <img id='codesection-_add_table_node-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-_add_table_node-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-_add_table_node-content' class='dyncontent' style='display: none;'> 
 <div class="fragment"><div class="line">sub <a class="code" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_utils_1_1_graph.html#a5f15e355d2750a68a1a219ef2decc55a">_add_table_node</a> {</div>
<div class="line">    my ($self, $table_node_name, $naked_table) = @_;</div>
<div class="line"></div>
<div class="line">    my $node_fontname    = $self-&gt;config_get(<span class="stringliteral">&#39;Node&#39;</span>, <span class="stringliteral">&#39;Table&#39;</span>, <span class="stringliteral">&#39;Font&#39;</span>);</div>
<div class="line">    my (@column_names, $columns, $table_data, $data_limit, $hit_limit);</div>
<div class="line"></div>
<div class="line">    my $hive_dba = $self-&gt;hive_dba;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>( $data_limit = $self-&gt;config_get(<span class="stringliteral">&#39;DisplayData&#39;</span>) and my $naked_table_adaptor = $hive_dba &amp;&amp; $hive_dba-&gt;get_NakedTableAdaptor ) {</div>
<div class="line">        $naked_table_adaptor-&gt;table_name( $naked_table-&gt;table_name );</div>
<div class="line"></div>
<div class="line">        @column_names = sort keys %{$naked_table_adaptor-&gt;column_set};</div>
<div class="line">        $columns = scalar(@column_names);</div>
<div class="line">        $table_data = $naked_table_adaptor-&gt;fetch_all( <span class="stringliteral">&#39;LIMIT &#39;</span>.($data_limit+1) );</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span>(scalar(@$table_data)&gt;$data_limit) {</div>
<div class="line">            pop @$table_data;</div>
<div class="line">            $hit_limit = 1;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    my $table_label = <span class="stringliteral">&#39;&lt;&lt;table border=&quot;0&quot; cellborder=&quot;0&quot; cellspacing=&quot;0&quot; cellpadding=&quot;1&quot;&gt;&lt;tr&gt;&lt;td colspan=&quot;&#39;</span>.($columns||1).<span class="stringliteral">&#39;&quot;&gt;&#39;</span>. $naked_table-&gt;display_name( $hive_dba ) .<span class="stringliteral">&#39;&lt;/td&gt;&lt;/tr&gt;&#39;</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>( $self-&gt;config_get(<span class="stringliteral">&#39;DisplayData&#39;</span>) ) {</div>
<div class="line">        $table_label .= <span class="stringliteral">&#39;&lt;tr&gt;&lt;td colspan=&quot;&#39;</span>.$columns.<span class="stringliteral">&#39;&quot;&gt; &lt;/td&gt;&lt;/tr&gt;&#39;</span>;</div>
<div class="line">        $table_label .= <span class="stringliteral">&#39;&lt;tr&gt;&#39;</span>.join(<span class="stringliteral">&#39;&#39;</span>, map { qq{&lt;td bgcolor=<span class="stringliteral">&quot;lightblue&quot;</span> border=<span class="stringliteral">&quot;1&quot;</span>&gt;$_&lt;/td&gt;} } @column_names).<span class="stringliteral">&#39;&lt;/tr&gt;&#39;</span>;</div>
<div class="line">        <span class="keywordflow">foreach</span> my $row (@$table_data) {</div>
<div class="line">            $table_label .= <span class="stringliteral">&#39;&lt;tr&gt;&#39;</span>.join(<span class="stringliteral">&#39;&#39;</span>, map { qq{&lt;td&gt;$_&lt;/td&gt;} } @{$row}{@column_names}).<span class="stringliteral">&#39;&lt;/tr&gt;&#39;</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span>($hit_limit) {</div>
<div class="line">            $table_label  .= qq{&lt;tr&gt;&lt;td colspan=<span class="stringliteral">&quot;$columns&quot;</span>&gt;[ more data ]&lt;/td&gt;&lt;/tr&gt;};</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    $table_label .= <span class="stringliteral">&#39;&lt;/table&gt;&gt;&#39;</span>;</div>
<div class="line"></div>
<div class="line">    $self-&gt;graph()-&gt;add_node( $table_node_name, </div>
<div class="line">        label =&gt; $table_label,</div>
<div class="line">        shape =&gt; <span class="stringliteral">&#39;record&#39;</span>,</div>
<div class="line">        fontname =&gt; $node_fontname,</div>
<div class="line">        color =&gt; $self-&gt;config_get(<span class="stringliteral">&#39;Node&#39;</span>, <span class="stringliteral">&#39;Table&#39;</span>, <span class="stringliteral">&#39;Colour&#39;</span>),</div>
<div class="line">    );</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">1;</div>
</div><!-- fragment --> </div> 
</div>
</div>
<a class="anchor" id="ab6415312e311c5a6fe8d7aa89ba3684a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">protected Bio::EnsEMBL::Hive::Utils::Graph::_analysis_node_name </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Undocumented method</p>
<div id="codesection-_analysis_node_name" class="dynheader closed" style="cursor:pointer;" onclick="return toggleVisibility(this)">  
    <img id='codesection-_analysis_node_name-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-_analysis_node_name-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-_analysis_node_name-content' class='dyncontent' style='display: none;'> 
 <div class="fragment"><div class="line">sub <a class="code" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_utils_1_1_graph.html#ab6415312e311c5a6fe8d7aa89ba3684a">_analysis_node_name</a> {</div>
<div class="line">    my ($self, $analysis) = @_;</div>
<div class="line"></div>
<div class="line">    my $analysis_node_name = <span class="stringliteral">&#39;analysis_&#39;</span> . $analysis-&gt;display_name( $self-&gt;hive_dba );</div>
<div class="line">    $analysis_node_name=~s/\W/__/g;</div>
<div class="line">    <span class="keywordflow">return</span> $analysis_node_name;</div>
<div class="line">}</div>
</div><!-- fragment --> </div> 
</div>
</div>
<a class="anchor" id="a546d1e3d214a8c2ba2c25a8d94ac0813"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">protected Bio::EnsEMBL::Hive::Utils::Graph::_midpoint_name </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Undocumented method</p>
<div id="codesection-_midpoint_name" class="dynheader closed" style="cursor:pointer;" onclick="return toggleVisibility(this)">  
    <img id='codesection-_midpoint_name-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-_midpoint_name-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-_midpoint_name-content' class='dyncontent' style='display: none;'> 
 <div class="fragment"><div class="line">sub <a class="code" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_utils_1_1_graph.html#a546d1e3d214a8c2ba2c25a8d94ac0813">_midpoint_name</a> {</div>
<div class="line">    my ($df_rule) = @_;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(scalar($df_rule)=~/\((\w+)\)/) {     # a unique <span class="keywordtype">id</span> of a df_rule assuming dbIDs are not available</div>
<div class="line">        <span class="keywordflow">return</span> <span class="stringliteral">&#39;dfr_&#39;</span>.$1.<span class="stringliteral">&#39;_mp&#39;</span>;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        die <span class="stringliteral">&quot;Wrong argument to _midpoint_name&quot;</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --> </div> 
</div>
</div>
<a class="anchor" id="aefb7c89ca1e64a84a64329aa7277e612"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">protected Bio::EnsEMBL::Hive::Utils::Graph::_propagate_allocation </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Undocumented method</p>
<div id="codesection-_propagate_allocation" class="dynheader closed" style="cursor:pointer;" onclick="return toggleVisibility(this)">  
    <img id='codesection-_propagate_allocation-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-_propagate_allocation-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-_propagate_allocation-content' class='dyncontent' style='display: none;'> 
 <div class="fragment"><div class="line">sub <a class="code" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_utils_1_1_graph.html#aefb7c89ca1e64a84a64329aa7277e612">_propagate_allocation</a> {</div>
<div class="line">    my ($self, $source_analysis ) = @_;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">foreach</span> my $df_rule ( @{ $source_analysis-&gt;dataflow_rules_collection } ) {    # <span class="keyword">this</span> will only work <span class="keywordflow">if</span> the analyses objects are ALL cached before loading DFRs</div>
<div class="line">        my $target_object       = $df_rule-&gt;to_analysis</div>
<div class="line">            or die <span class="stringliteral">&quot;Could not fetch a target object for url=&#39;&quot;</span>.$df_rule-&gt;to_analysis_url.<span class="stringliteral">&quot;&#39;, please check your database for consistency.\n&quot;</span>;</div>
<div class="line"></div>
<div class="line">        my $target_node_name;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span>(UNIVERSAL::isa($target_object, <span class="stringliteral">&#39;Bio::EnsEMBL::Hive::Analysis&#39;</span>)) {</div>
<div class="line">            $target_node_name = $self-&gt;_analysis_node_name( $target_object );</div>
<div class="line">        } elsif(UNIVERSAL::isa($target_object, <span class="stringliteral">&#39;Bio::EnsEMBL::Hive::NakedTable&#39;</span>)) {</div>
<div class="line">            $target_node_name = $self-&gt;_table_node_name( $df_rule );</div>
<div class="line">        } elsif(UNIVERSAL::isa($target_object, <span class="stringliteral">&#39;Bio::EnsEMBL::Hive::Accumulator&#39;</span>)) {</div>
<div class="line">            next;</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            warn(<span class="stringliteral">&quot;Do not know how to handle the type &#39;&quot;</span>.ref($target_object).<span class="stringliteral">&quot;&#39;&quot;</span>);</div>
<div class="line">            next;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        my $proposed_funnel_dfr;    # will depend on whether we start a <span class="keyword">new</span> semaphore</div>
<div class="line"></div>
<div class="line">        my $funnel_dataflow_rule  = $df_rule-&gt;funnel_dataflow_rule();</div>
<div class="line">        <span class="keywordflow">if</span>( $funnel_dataflow_rule ) {   # <span class="keywordflow">if</span> there is a <span class="keyword">new</span> semaphore, the dfrs involved (their midpoints) will also have to be allocated</div>
<div class="line">            $proposed_funnel_dfr = $funnel_dataflow_rule;       # <span class="keywordflow">if</span> we <span class="keywordflow">do</span> start a <span class="keyword">new</span> semaphore, report to the <span class="keyword">new</span> funnel (based on common funnel rule<span class="stringliteral">&#39;s midpoint)</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">            $df_rule-&gt;{&#39;</span>_funnel_dfr<span class="stringliteral">&#39;} = $proposed_funnel_dfr;</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">            $funnel_dataflow_rule-&gt;{&#39;</span>_funnel_dfr<span class="stringliteral">&#39;} = $source_analysis-&gt;{&#39;</span>_funnel_dfr<span class="stringliteral">&#39;}; # draw the funnel&#39;</span>s midpoint outside of the box</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            $proposed_funnel_dfr = $source_analysis-&gt;{<span class="stringliteral">&#39;_funnel_dfr&#39;</span>} || <span class="stringliteral">&#39;&#39;</span>; # <span class="keywordflow">if</span> we don<span class="stringliteral">&#39;t start a new semaphore, inherit the allocation of the source</span></div>
<div class="line"><span class="stringliteral">        }</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">            # we allocate on first-come basis at the moment:</span></div>
<div class="line"><span class="stringliteral">        if( exists $target_object-&gt;{&#39;</span>_funnel_dfr<span class="stringliteral">&#39;} ) {  # node is already allocated?</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">            my $known_funnel_dfr = $target_object-&gt;{&#39;</span>_funnel_dfr<span class="stringliteral">&#39;};</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">            if( $known_funnel_dfr eq $proposed_funnel_dfr) {</span></div>
<div class="line"><span class="stringliteral">                # warn &quot;analysis &#39;</span>$target_node_name<span class="stringliteral">&#39; has already been allocated to the same &#39;</span>$known_funnel_dfr<span class="stringliteral">&#39; by another branch&quot;;</span></div>
<div class="line"><span class="stringliteral">            } else {</span></div>
<div class="line"><span class="stringliteral">                # warn &quot;analysis &#39;</span>$target_node_name<span class="stringliteral">&#39; has already been allocated to &#39;</span>$known_funnel_dfr<span class="stringliteral">&#39; however this branch would allocate it to &#39;</span>$proposed_funnel_dfr<span class="stringliteral">&#39;&quot;;</span></div>
<div class="line"><span class="stringliteral">            }</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">            if($funnel_dataflow_rule) {  # correction for multiple entries into the same box (probably needs re-thinking)</span></div>
<div class="line"><span class="stringliteral">                $df_rule-&gt;{&#39;</span>_funnel_dfr<span class="stringliteral">&#39;} = $target_object-&gt;{&#39;</span>_funnel_dfr<span class="stringliteral">&#39;};</span></div>
<div class="line"><span class="stringliteral">            }</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">        } else {</span></div>
<div class="line"><span class="stringliteral">            # warn &quot;allocating analysis &#39;</span>$target_node_name<span class="stringliteral">&#39; to &#39;</span>$proposed_funnel_dfr<span class="stringliteral">&#39;&quot;;</span></div>
<div class="line"><span class="stringliteral">            $target_object-&gt;{&#39;</span>_funnel_dfr<span class="stringliteral">&#39;} = $proposed_funnel_dfr;</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">            if(UNIVERSAL::isa($target_object, &#39;</span><a class="code" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_analysis.html">Bio::EnsEMBL::Hive::Analysis</a><span class="stringliteral">&#39;)) {</span></div>
<div class="line"><span class="stringliteral">                $self-&gt;_propagate_allocation( $target_object );</span></div>
<div class="line"><span class="stringliteral">            }</span></div>
<div class="line"><span class="stringliteral">        }</span></div>
<div class="line"><span class="stringliteral">    }</span></div>
<div class="line"><span class="stringliteral">}</span></div>
</div><!-- fragment --> </div> 
</div>
</div>
<a class="anchor" id="af860b66fd159323a7c507fa27b2f3794"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">protected Bio::EnsEMBL::Hive::Utils::Graph::_table_node_name </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Undocumented method</p>
<div id="codesection-_table_node_name" class="dynheader closed" style="cursor:pointer;" onclick="return toggleVisibility(this)">  
    <img id='codesection-_table_node_name-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-_table_node_name-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-_table_node_name-content' class='dyncontent' style='display: none;'> 
 <div class="fragment"><div class="line">sub <a class="code" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_utils_1_1_graph.html#af860b66fd159323a7c507fa27b2f3794">_table_node_name</a> {</div>
<div class="line">    my ($self, $df_rule) = @_;</div>
<div class="line"></div>
<div class="line">    my $table_node_name = <span class="stringliteral">&#39;table_&#39;</span> . $df_rule-&gt;to_analysis-&gt;display_name( $self-&gt;hive_dba ) .</div>
<div class="line">                ($self-&gt;config_get(<span class="stringliteral">&#39;DuplicateTables&#39;</span>) ?  <span class="charliteral">&#39;_&#39;</span>.$df_rule-&gt;from_analysis-&gt;logic_name : <span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line">    $table_node_name=~s/\W/__/g;</div>
<div class="line">    <span class="keywordflow">return</span> $table_node_name;</div>
<div class="line">}</div>
</div><!-- fragment --> </div> 
</div>
</div>
<a class="anchor" id="ad7fad3a0d313ae9d07c6b6e636876109"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public The Bio::EnsEMBL::Hive::Utils::Graph::build </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre>
  Returntype : The <a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_utils_1_1_graph_viz.html">GraphViz</a> object built &amp; populated
  Exceptions : Raised if there are issues with accessing the database
  Description : Builds the graph object and returns it.
  Status     : Beta</pre><pre> </pre><div id="codesection-build" class="dynheader closed" style="cursor:pointer;" onclick="return toggleVisibility(this)">  
    <img id='codesection-build-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-build-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-build-content' class='dyncontent' style='display: none;'> 
 <div class="fragment"><div class="line">sub <a class="code" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_utils_1_1_graph.html#ad7fad3a0d313ae9d07c6b6e636876109">build</a> {</div>
<div class="line">    my ($self) = @_;</div>
<div class="line"></div>
<div class="line">    my $hive_dba = $self-&gt;hive_dba;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>( my $job_limit = $self-&gt;config_get(<span class="stringliteral">&#39;DisplayJobs&#39;</span>) and my $job_adaptor = $hive_dba &amp;&amp; $hive_dba-&gt;get_AnalysisJobAdaptor ) {</div>
<div class="line">        <span class="keywordflow">foreach</span> my $analysis ( <a class="code" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_analysis.html">Bio::EnsEMBL::Hive::Analysis</a>-&gt;collection()-&gt;list ) {</div>
<div class="line">            my @jobs = sort {$a-&gt;dbID &lt;=&gt; $b-&gt;dbID} @{ $job_adaptor-&gt;fetch_some_by_analysis_id_limit( $analysis-&gt;dbID, $job_limit+1 )};</div>
<div class="line">            $analysis-&gt;jobs_collection( \@jobs );</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">foreach</span> my $df_rule ( <a class="code" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_dataflow_rule.html">Bio::EnsEMBL::Hive::DataflowRule</a>-&gt;collection()-&gt;list ) {</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span>(my $target_object = <a class="code" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_analysis.html">Bio::EnsEMBL::Hive::Analysis</a>-&gt;collection()-&gt;find_one_by(<span class="stringliteral">&#39;logic_name&#39;</span>, $df_rule-&gt;to_analysis_url )) {</div>
<div class="line">            $df_rule-&gt;to_analysis( $target_object );</div>
<div class="line">            <span class="keywordflow">if</span>(UNIVERSAL::isa($target_object, <span class="stringliteral">&#39;Bio::EnsEMBL::Hive::Analysis&#39;</span>)) {</div>
<div class="line">                $target_object-&gt;{<span class="stringliteral">&#39;_inflow_count&#39;</span>}++;</div>
<div class="line">            }</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            $target_object = $df_rule-&gt;to_analysis</div>
<div class="line">                or die <span class="stringliteral">&quot;Could not fetch a target object for url=&#39;&quot;</span>.$df_rule-&gt;to_analysis_url.<span class="stringliteral">&quot;&#39;, please check your database for consistency.\n&quot;</span>;</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span>( UNIVERSAL::isa($target_object, <span class="stringliteral">&#39;Bio::EnsEMBL::Hive::Analysis&#39;</span>) ) { # dataflow target is a foreign Analysis</div>
<div class="line">                $target_object-&gt;{<span class="stringliteral">&#39;_foreign&#39;</span>}=1;</div>
<div class="line">                <a class="code" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_analysis.html">Bio::EnsEMBL::Hive::Analysis</a>-&gt;<a class="code" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_cacheable.html#a1c4430cb41931838b7bcf32ddc0e76a6">collection</a>()-&gt;add( $target_object );  # add it to the collection</div>
<div class="line">                my $foreign_stats = $target_object-&gt;stats or die <span class="stringliteral">&quot;Could not fetch foreign stats for &quot;</span>.$target_object-&gt;display_name( $self-&gt;hive_dba );</div>
<div class="line">                <a class="code" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_analysis_stats.html">Bio::EnsEMBL::Hive::AnalysisStats</a>-&gt;<a class="code" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_cacheable.html#a1c4430cb41931838b7bcf32ddc0e76a6">collection</a>()-&gt;add( $foreign_stats ); # add it to the collection</div>
<div class="line">            } elsif( UNIVERSAL::isa($target_object, <span class="stringliteral">&#39;Bio::EnsEMBL::Hive::NakedTable&#39;</span>) ) {</div>
<div class="line">            } elsif( UNIVERSAL::isa($target_object, <span class="stringliteral">&#39;Bio::EnsEMBL::Hive::Accumulator&#39;</span>) ) {</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                warn <span class="stringliteral">&quot;Do not know how to handle the type &#39;&quot;</span>.ref($target_object).<span class="stringliteral">&quot;&#39;&quot;</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span>( my $funnel_dataflow_rule  = $df_rule-&gt;funnel_dataflow_rule ) {</div>
<div class="line">            $funnel_dataflow_rule-&gt;{<span class="stringliteral">&#39;_is_a_funnel&#39;</span>}++;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">foreach</span> my $c_rule ( <a class="code" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_analysis_ctrl_rule.html">Bio::EnsEMBL::Hive::AnalysisCtrlRule</a>-&gt;collection()-&gt;list ) {   # control rule<span class="stringliteral">&#39;s condition is a foreign Analysis</span></div>
<div class="line"><span class="stringliteral">        unless( Bio::EnsEMBL::Hive::Analysis-&gt;collection()-&gt;find_one_by(&#39;</span>logic_name<span class="stringliteral">&#39;, $c_rule-&gt;condition_analysis_url )) {</span></div>
<div class="line"><span class="stringliteral">            my $condition_analysis = $c_rule-&gt;condition_analysis();</span></div>
<div class="line"><span class="stringliteral">            $condition_analysis-&gt;{&#39;</span>_foreign<span class="stringliteral">&#39;}=1;</span></div>
<div class="line"><span class="stringliteral">            Bio::EnsEMBL::Hive::Analysis-&gt;collection()-&gt;add( $condition_analysis ); # add it to the collection</span></div>
<div class="line"><span class="stringliteral">            my $foreign_stats = $condition_analysis-&gt;stats or die &quot;Could not fetch foreign stats for &quot;.$condition_analysis-&gt;display_name( $self-&gt;hive_dba );</span></div>
<div class="line"><span class="stringliteral">            Bio::EnsEMBL::Hive::AnalysisStats-&gt;collection()-&gt;add( $foreign_stats ); # add it to the collection</span></div>
<div class="line"><span class="stringliteral">        }</span></div>
<div class="line"><span class="stringliteral">    }</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">        # NB: this is a very approximate algorithm with rough edges!</span></div>
<div class="line"><span class="stringliteral">        # It will not find all start nodes in cyclic components!</span></div>
<div class="line"><span class="stringliteral">    foreach my $source_analysis ( Bio::EnsEMBL::Hive::Analysis-&gt;collection()-&gt;list ) {</span></div>
<div class="line"><span class="stringliteral">        unless( $source_analysis-&gt;{&#39;</span>_inflow_count<span class="stringliteral">&#39;} or $source_analysis-&gt;{&#39;</span>_foreign<span class="stringliteral">&#39;} ) {    # if there is no dataflow into this analysis</span></div>
<div class="line"><span class="stringliteral">                # run the recursion in each component that has a non-cyclic start:</span></div>
<div class="line"><span class="stringliteral">            $self-&gt;_propagate_allocation( $source_analysis );</span></div>
<div class="line"><span class="stringliteral">        }</span></div>
<div class="line"><span class="stringliteral">    }</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">    if( $self-&gt;config_get(&#39;</span>DisplayDetails<span class="stringliteral">&#39;) and my $dbc = $hive_dba &amp;&amp; $hive_dba-&gt;dbc ) {</span></div>
<div class="line"><span class="stringliteral">        my $pipeline_label = sprintf(&#39;</span>%s@%s<span class="stringliteral">&#39;, $dbc-&gt;dbname, $dbc-&gt;host || &#39;</span>-<span class="stringliteral">&#39;);</span></div>
<div class="line"><span class="stringliteral">        $self-&gt;_add_pipeline_label( $pipeline_label );</span></div>
<div class="line"><span class="stringliteral">    }</span></div>
<div class="line"><span class="stringliteral">    foreach my $analysis ( Bio::EnsEMBL::Hive::Analysis-&gt;collection()-&gt;list ) {</span></div>
<div class="line"><span class="stringliteral">        $self-&gt;_add_analysis_node($analysis);</span></div>
<div class="line"><span class="stringliteral">    }</span></div>
<div class="line"><span class="stringliteral">    foreach my $analysis ( Bio::EnsEMBL::Hive::Analysis-&gt;collection()-&gt;list ) {</span></div>
<div class="line"><span class="stringliteral">        $self-&gt;_add_control_rules( $analysis-&gt;control_rules_collection );</span></div>
<div class="line"><span class="stringliteral">        $self-&gt;_add_dataflow_rules( $analysis-&gt;dataflow_rules_collection );</span></div>
<div class="line"><span class="stringliteral">    }</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">    if($self-&gt;config_get(&#39;</span>DisplayStretched<span class="stringliteral">&#39;) ) {    # put each analysis before its&#39;</span> funnel midpoint</div>
<div class="line">        <span class="keywordflow">foreach</span> my $analysis ( <a class="code" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_analysis.html">Bio::EnsEMBL::Hive::Analysis</a>-&gt;collection()-&gt;list ) {</div>
<div class="line">            <span class="keywordflow">if</span>($analysis-&gt;{<span class="stringliteral">&#39;_funnel_dfr&#39;</span>}) {    # <span class="keyword">this</span> should only affect analyses that have a funnel</div>
<div class="line">                my $from = $self-&gt;_analysis_node_name( $analysis );</div>
<div class="line">                my $to   = <a class="code" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_utils_1_1_graph.html#a546d1e3d214a8c2ba2c25a8d94ac0813">_midpoint_name</a>( $analysis-&gt;{<span class="stringliteral">&#39;_funnel_dfr&#39;</span>} );</div>
<div class="line">                $self-&gt;graph-&gt;add_edge( $from =&gt; $to,</div>
<div class="line">                    color     =&gt; <span class="stringliteral">&#39;black&#39;</span>,</div>
<div class="line">                    style     =&gt; <span class="stringliteral">&#39;invis&#39;</span>,   # toggle visibility by changing <span class="stringliteral">&#39;invis&#39;</span> to <span class="stringliteral">&#39;dashed&#39;</span></div>
<div class="line">                );</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>($self-&gt;config_get(<span class="stringliteral">&#39;DisplaySemaphoreBoxes&#39;</span>) ) {</div>
<div class="line">        my %cluster_2_nodes = ();</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">foreach</span> my $analysis ( <a class="code" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_analysis.html">Bio::EnsEMBL::Hive::Analysis</a>-&gt;collection()-&gt;list ) {</div>
<div class="line">            <span class="keywordflow">if</span>(my $funnel = $analysis-&gt;{<span class="stringliteral">&#39;_funnel_dfr&#39;</span>}) {</div>
<div class="line">                push @{$cluster_2_nodes{ <a class="code" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_utils_1_1_graph.html#a546d1e3d214a8c2ba2c25a8d94ac0813">_midpoint_name</a>( $funnel ) } }, $self-&gt;_analysis_node_name( $analysis );</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">foreach</span> my $df_rule ( @{ $analysis-&gt;dataflow_rules_collection } ) {</div>
<div class="line">                <span class="keywordflow">if</span>( $df_rule-&gt;{<span class="stringliteral">&#39;_is_a_funnel&#39;</span>} and ! $df_rule-&gt;{<span class="stringliteral">&#39;_funnel_dfr&#39;</span>} ) {</div>
<div class="line"></div>
<div class="line">                    push @{$cluster_2_nodes{ <span class="stringliteral">&#39;&#39;</span> }}, <a class="code" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_utils_1_1_graph.html#a546d1e3d214a8c2ba2c25a8d94ac0813">_midpoint_name</a>( $df_rule );     # top-level funnels define clusters (top-level <span class="stringliteral">&quot;boxes&quot;</span>)</div>
<div class="line"></div>
<div class="line">                } elsif( UNIVERSAL::isa($df_rule-&gt;to_analysis, <span class="stringliteral">&#39;Bio::EnsEMBL::Hive::NakedTable&#39;</span>) ) {</div>
<div class="line"></div>
<div class="line">                    <span class="keywordflow">if</span>(my $funnel = $df_rule-&gt;to_analysis-&gt;{<span class="stringliteral">&#39;_funnel_dfr&#39;</span>}) {</div>
<div class="line">                        push @{$cluster_2_nodes{ <a class="code" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_utils_1_1_graph.html#a546d1e3d214a8c2ba2c25a8d94ac0813">_midpoint_name</a>( $funnel ) } }, $self-&gt;_table_node_name( $df_rule );    # table belongs to the same <span class="stringliteral">&quot;box&quot;</span> as the dataflow source</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">if</span>(my $funnel = $df_rule-&gt;{<span class="stringliteral">&#39;_funnel_dfr&#39;</span>}) {</div>
<div class="line">                    push @{$cluster_2_nodes{ <a class="code" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_utils_1_1_graph.html#a546d1e3d214a8c2ba2c25a8d94ac0813">_midpoint_name</a>( $funnel ) } }, <a class="code" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_utils_1_1_graph.html#a546d1e3d214a8c2ba2c25a8d94ac0813">_midpoint_name</a>( $df_rule ); # midpoints of rules that have a funnel live inside <span class="stringliteral">&quot;boxes&quot;</span></div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        $self-&gt;graph-&gt;cluster_2_nodes( \%cluster_2_nodes );</div>
<div class="line">        $self-&gt;graph-&gt;colour_scheme( $self-&gt;config_get(<span class="stringliteral">&#39;Box&#39;</span>, <span class="stringliteral">&#39;ColourScheme&#39;</span>) );</div>
<div class="line">        $self-&gt;graph-&gt;colour_offset( $self-&gt;config_get(<span class="stringliteral">&#39;Box&#39;</span>, <span class="stringliteral">&#39;ColourOffset&#39;</span>) );</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> $self-&gt;graph();</div>
<div class="line">}</div>
</div><!-- fragment --> </div> 
</div>
</div>
<a class="anchor" id="a5f9efde876681aea12fc343faae97dab"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public <a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_utils_1_1_graph_viz.html">GraphViz</a> Bio::EnsEMBL::Hive::Utils::Graph::graph </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre>
  Arg [1] : The <a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_utils_1_1_graph_viz.html">GraphViz</a> instance created by this module
  Returntype : <a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_utils_1_1_graph_viz.html">GraphViz</a>
  Exceptions : None
  Status     : Beta</pre><pre> </pre><div id="codesection-graph" class="dynheader closed" style="cursor:pointer;" onclick="return toggleVisibility(this)">  
    <img id='codesection-graph-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-graph-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-graph-content' class='dyncontent' style='display: none;'> 
 <div class="fragment"><div class="line">sub <a class="code" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_utils_1_1_graph.html#a5f9efde876681aea12fc343faae97dab">graph</a> {</div>
<div class="line">    my ($self) = @_;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(! exists $self-&gt;{<a class="code" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_utils_1_1_graph.html#a5f9efde876681aea12fc343faae97dab">graph</a>}) {</div>
<div class="line">        my $padding  = $self-&gt;config_get(<span class="stringliteral">&#39;Pad&#39;</span>) || 0;</div>
<div class="line">        $self-&gt;{<a class="code" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_utils_1_1_graph.html#a5f9efde876681aea12fc343faae97dab">graph</a>} = <a class="code" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_utils_1_1_graph_viz.html">Bio::EnsEMBL::Hive::Utils::GraphViz</a>-&gt;new( name =&gt; <span class="stringliteral">&#39;AnalysisWorkflow&#39;</span>, ratio =&gt; qq{compress<span class="stringliteral">&quot;; pad = &quot;</span>$padding}  ); # injection hack!</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> $self-&gt;{<a class="code" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_utils_1_1_graph.html#a5f9efde876681aea12fc343faae97dab">graph</a>};</div>
<div class="line">}</div>
</div><!-- fragment --> </div> 
</div>
</div>
<a class="anchor" id="ac8693dd43801529d292bcad623b6360c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public DBAdaptor Bio::EnsEMBL::Hive::Utils::Graph::hive_dba </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre>
  Arg [1] : The DBAdaptor instance
  Returntype : DBAdaptor
  Exceptions : If the given object is not a hive DBAdaptor
  Status     : Beta</pre><pre> </pre><div id="codesection-hive_dba" class="dynheader closed" style="cursor:pointer;" onclick="return toggleVisibility(this)">  
    <img id='codesection-hive_dba-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-hive_dba-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-hive_dba-content' class='dyncontent' style='display: none;'> 
 <div class="fragment"><div class="line">sub <a class="code" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_utils_1_1_graph.html#ac8693dd43801529d292bcad623b6360c">hive_dba</a> {</div>
<div class="line">    my $self = shift @_;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(@_) {</div>
<div class="line">        $self-&gt;{<span class="stringliteral">&#39;hive_dba&#39;</span>} = shift @_;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> $self-&gt;{<span class="stringliteral">&#39;hive_dba&#39;</span>};</div>
<div class="line">}</div>
</div><!-- fragment --> </div> 
</div>
</div>
<a class="anchor" id="a0452e8098246f27173059b14600f190c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public <a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_utils_1_1_graph.html">Graph</a> Bio::EnsEMBL::Hive::Utils::Graph::new </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre>
  Arg [1] : <a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_d_b_s_q_l_1_1_d_b_adaptor.html">Bio::EnsEMBL::Hive::DBSQL::DBAdaptor</a> $hive_dba;
              The adaptor to get information from
  Arg [2] : (optional) string $config_file_name;
                  A JSON file name to initialize the <a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_utils_1_1_config.html">Config</a> object with.
                  If one is not given then we don't pass anything into <a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_utils_1_1_config.html">Config</a>'s constructor,
                  which results in loading configuration from <a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_utils_1_1_config.html">Config</a>'s standard locations.
  Returntype : <a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_utils_1_1_graph.html">Graph</a> object
  Exceptions : If the parameters are not as required
  Status     : Beta</pre><pre> </pre><div id="codesection-new" class="dynheader closed" style="cursor:pointer;" onclick="return toggleVisibility(this)">  
    <img id='codesection-new-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-new-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-new-content' class='dyncontent' style='display: none;'> 
 <div class="fragment"><div class="line">sub <span class="keyword">new</span> {</div>
<div class="line">    my $class       = shift @_;</div>
<div class="line">    my $hive_dba    = shift @_;</div>
<div class="line"></div>
<div class="line">    my $self = bless({}, ref($class) || $class);</div>
<div class="line"></div>
<div class="line">    $self-&gt;hive_dba($hive_dba);</div>
<div class="line">    my $config = <a class="code" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_utils_1_1_config.html">Bio::EnsEMBL::Hive::Utils::Config</a>-&gt;<a class="code" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_utils_1_1_config.html#ae74fdb113363f2f412a30ce66d1651e3">new</a>( @_ );</div>
<div class="line">    $self-&gt;config($config);</div>
<div class="line">    $self-&gt;context( [ <span class="stringliteral">&#39;Graph&#39;</span> ] );</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> $self;</div>
<div class="line">}</div>
</div><!-- fragment --> </div> 
</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>modules/Bio/EnsEMBL/Hive/Utils/<a class="el" href="_graph_8pm.html">Graph.pm</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespace_bio.html">Bio</a></li><li class="navelem"><a class="el" href="namespace_bio_1_1_ens_e_m_b_l.html">EnsEMBL</a></li><li class="navelem"><a class="el" href="namespace_bio_1_1_ens_e_m_b_l_1_1_hive.html">Hive</a></li><li class="navelem"><a class="el" href="namespace_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_utils.html">Utils</a></li><li class="navelem"><a class="el" href="class_bio_1_1_ens_e_m_b_l_1_1_hive_1_1_utils_1_1_graph.html">Graph</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
